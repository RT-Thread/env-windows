.\" Man page generated from reStructuredText.
.
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.TH "QEMU" "1" "Dec 30, 2022" "7.2.0" "QEMU"
.SH NAME
qemu \- QEMU User Documentation
.SH SYNOPSIS
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 [options] [disk_image]
.ft P
.fi
.UNINDENT
.UNINDENT
.SH DESCRIPTION
.sp
The QEMU PC System emulator simulates the following peripherals:
.INDENT 0.0
.IP \(bu 2
i440FX host PCI bridge and PIIX3 PCI to ISA bridge
.IP \(bu 2
Cirrus CLGD 5446 PCI VGA card or dummy VGA card with Bochs VESA
extensions (hardware level, including all non standard modes).
.IP \(bu 2
PS/2 mouse and keyboard
.IP \(bu 2
2 PCI IDE interfaces with hard disk and CD\-ROM support
.IP \(bu 2
Floppy disk
.IP \(bu 2
PCI and ISA network adapters
.IP \(bu 2
Serial ports
.IP \(bu 2
IPMI BMC, either and internal or external one
.IP \(bu 2
Creative SoundBlaster 16 sound card
.IP \(bu 2
ENSONIQ AudioPCI ES1370 sound card
.IP \(bu 2
Intel 82801AA AC97 Audio compatible sound card
.IP \(bu 2
Intel HD Audio Controller and HDA codec
.IP \(bu 2
Adlib (OPL2) \- Yamaha YM3812 compatible chip
.IP \(bu 2
Gravis Ultrasound GF1 sound card
.IP \(bu 2
CS4231A compatible sound card
.IP \(bu 2
PC speaker
.IP \(bu 2
PCI UHCI, OHCI, EHCI or XHCI USB controller and a virtual USB\-1.1
hub.
.UNINDENT
.sp
SMP is supported with up to 255 CPUs.
.sp
QEMU uses the PC BIOS from the Seabios project and the Plex86/Bochs LGPL
VGA BIOS.
.sp
QEMU uses YM3812 emulation by Tatsuyuki Satoh.
.sp
QEMU uses GUS emulation (GUSEMU32 \fI\%http://www.deinmeister.de/gusemu/\fP) by
Tibor "TS" Sch√ºtz.
.sp
Note that, by default, GUS shares IRQ(7) with parallel ports and so QEMU
must be told to not have parallel ports to have working GUS.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 dos.img \-device gus \-parallel none
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Alternatively:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 dos.img \-device gus,irq=5
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Or some other unclaimed IRQ.
.sp
CS4231A is the chip used in Windows Sound System and GUSMAX products
.sp
The PC speaker audio device can be configured using the pcspk\-audiodev
machine property, i.e.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 some.img \-audiodev <backend>,id=<name> \-machine pcspk\-audiodev=<name>
.ft P
.fi
.UNINDENT
.UNINDENT
.SH OPTIONS
.sp
disk_image is a raw hard disk image for IDE hard disk 0. Some targets do
not need a disk image.
.SS Standard options
.INDENT 0.0
.TP
.B \fB\-h\fP
Display help and exit
.TP
.B \fB\-version\fP
Display version information and exit
.TP
.B \fB\-machine [type=]name[,prop=value[,...]]\fP
Select the emulated machine by name. Use \fB\-machine help\fP to list
available machines.
.sp
For architectures which aim to support live migration compatibility
across releases, each release will introduce a new versioned machine
type. For example, the 2.8.0 release introduced machine types
"pc\-i440fx\-2.8" and "pc\-q35\-2.8" for the x86_64/i686 architectures.
.sp
To allow live migration of guests from QEMU version 2.8.0, to QEMU
version 2.9.0, the 2.9.0 version must support the "pc\-i440fx\-2.8"
and "pc\-q35\-2.8" machines too. To allow users live migrating VMs to
skip multiple intermediate releases when upgrading, new releases of
QEMU will support machine types from many previous versions.
.sp
Supported machine properties are:
.INDENT 7.0
.TP
.B \fBaccel=accels1[:accels2[:...]]\fP
This is used to enable an accelerator. Depending on the target
architecture, kvm, xen, hax, hvf, nvmm, whpx or tcg can be available.
By default, tcg is used. If there is more than one accelerator
specified, the next one is used if the previous one fails to
initialize.
.TP
.B \fBvmport=on|off|auto\fP
Enables emulation of VMWare IO port, for vmmouse etc. auto says
to select the value based on accel. For accel=xen the default is
off otherwise the default is on.
.TP
.B \fBdump\-guest\-core=on|off\fP
Include guest memory in a core dump. The default is on.
.TP
.B \fBmem\-merge=on|off\fP
Enables or disables memory merge support. This feature, when
supported by the host, de\-duplicates identical memory pages
among VMs instances (enabled by default).
.TP
.B \fBaes\-key\-wrap=on|off\fP
Enables or disables AES key wrapping support on s390\-ccw hosts.
This feature controls whether AES wrapping keys will be created
to allow execution of AES cryptographic functions. The default
is on.
.TP
.B \fBdea\-key\-wrap=on|off\fP
Enables or disables DEA key wrapping support on s390\-ccw hosts.
This feature controls whether DEA wrapping keys will be created
to allow execution of DEA cryptographic functions. The default
is on.
.TP
.B \fBnvdimm=on|off\fP
Enables or disables NVDIMM support. The default is off.
.TP
.B \fBmemory\-encryption=\fP
Memory encryption object to use. The default is none.
.TP
.B \fBhmat=on|off\fP
Enables or disables ACPI Heterogeneous Memory Attribute Table
(HMAT) support. The default is off.
.TP
.B \fBmemory\-backend=\(aqid\(aq\fP
An alternative to legacy \fB\-mem\-path\fP and \fBmem\-prealloc\fP options.
Allows to use a memory backend as main RAM.
.sp
For example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-object memory\-backend\-file,id=pc.ram,size=512M,mem\-path=/hugetlbfs,prealloc=on,share=on
\-machine memory\-backend=pc.ram
\-m 512M
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Migration compatibility note:
.INDENT 7.0
.IP \(bu 2
as backend id one shall use value of \(aqdefault\-ram\-id\(aq, advertised by
machine type (available via \fBquery\-machines\fP QMP command), if migration
to/from old QEMU (<5.0) is expected.
.IP \(bu 2
for machine types 4.0 and older, user shall
use \fBx\-use\-canonical\-path\-for\-ramblock\-id=off\fP backend option
if migration to/from old QEMU (<5.0) is expected.
.UNINDENT
.sp
For example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-object memory\-backend\-ram,id=pc.ram,size=512M,x\-use\-canonical\-path\-for\-ramblock\-id=off
\-machine memory\-backend=pc.ram
\-m 512M
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBcxl\-fmw.0.targets.0=firsttarget,cxl\-fmw.0.targets.1=secondtarget,cxl\-fmw.0.size=size[,cxl\-fmw.0.interleave\-granularity=granularity]\fP
Define a CXL Fixed Memory Window (CFMW).
.sp
Described in the CXL 2.0 ECN: CEDT CFMWS & QTG _DSM.
.sp
They are regions of Host Physical Addresses (HPA) on a system which
may be interleaved across one or more CXL host bridges.  The system
software will assign particular devices into these windows and
configure the downstream Host\-managed Device Memory (HDM) decoders
in root ports, switch ports and devices appropriately to meet the
interleave requirements before enabling the memory devices.
.sp
\fBtargets.X=target\fP provides the mapping to CXL host bridges
which may be identified by the id provided in the \-device entry.
Multiple entries are needed to specify all the targets when
the fixed memory window represents interleaved memory. X is the
target index from 0.
.sp
\fBsize=size\fP sets the size of the CFMW. This must be a multiple of
256MiB. The region will be aligned to 256MiB but the location is
platform and configuration dependent.
.sp
\fBinterleave\-granularity=granularity\fP sets the granularity of
interleave. Default 256KiB. Only 256KiB, 512KiB, 1024KiB, 2048KiB
4096KiB, 8192KiB and 16384KiB granularities supported.
.sp
Example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-machine cxl\-fmw.0.targets.0=cxl.0,cxl\-fmw.0.targets.1=cxl.1,cxl\-fmw.0.size=128G,cxl\-fmw.0.interleave\-granularity=512k
.ft P
.fi
.UNINDENT
.UNINDENT
.UNINDENT
.TP
.B \fBsgx\-epc.0.memdev=@var{memid},sgx\-epc.0.node=@var{numaid}\fP
Define an SGX EPC section.
.TP
.B \fB\-cpu model\fP
Select CPU model (\fB\-cpu help\fP for list and additional feature
selection)
.TP
.B \fB\-accel name[,prop=value[,...]]\fP
This is used to enable an accelerator. Depending on the target
architecture, kvm, xen, hax, hvf, nvmm, whpx or tcg can be available. By
default, tcg is used. If there is more than one accelerator
specified, the next one is used if the previous one fails to
initialize.
.INDENT 7.0
.TP
.B \fBigd\-passthru=on|off\fP
When Xen is in use, this option controls whether Intel
integrated graphics devices can be passed through to the guest
(default=off)
.TP
.B \fBkernel\-irqchip=on|off|split\fP
Controls KVM in\-kernel irqchip support. The default is full
acceleration of the interrupt controllers. On x86, split irqchip
reduces the kernel attack surface, at a performance cost for
non\-MSI interrupts. Disabling the in\-kernel irqchip completely
is not recommended except for debugging purposes.
.TP
.B \fBkvm\-shadow\-mem=size\fP
Defines the size of the KVM shadow MMU.
.TP
.B \fBsplit\-wx=on|off\fP
Controls the use of split w^x mapping for the TCG code generation
buffer. Some operating systems require this to be enabled, and in
such a case this will default on. On other operating systems, this
will default off, but one may enable this for testing or debugging.
.TP
.B \fBtb\-size=n\fP
Controls the size (in MiB) of the TCG translation block cache.
.TP
.B \fBthread=single|multi\fP
Controls number of TCG threads. When the TCG is multi\-threaded
there will be one thread per vCPU therefore taking advantage of
additional host cores. The default is to enable multi\-threading
where both the back\-end and front\-ends support it and no
incompatible TCG features have been enabled (e.g.
icount/replay).
.TP
.B \fBdirty\-ring\-size=n\fP
When the KVM accelerator is used, it controls the size of the per\-vCPU
dirty page ring buffer (number of entries for each vCPU). It should
be a value that is power of two, and it should be 1024 or bigger (but
still less than the maximum value that the kernel supports).  4096
could be a good initial value if you have no idea which is the best.
Set this value to 0 to disable the feature.  By default, this feature
is disabled (dirty\-ring\-size=0).  When enabled, KVM will instead
record dirty pages in a bitmap.
.TP
.B \fBnotify\-vmexit=run|internal\-error|disable,notify\-window=n\fP
Enables or disables notify VM exit support on x86 host and specify
the corresponding notify window to trigger the VM exit if enabled.
\fBrun\fP option enables the feature. It does nothing and continue
if the exit happens. \fBinternal\-error\fP option enables the feature.
It raises a internal error. \fBdisable\fP option doesn\(aqt enable the feature.
This feature can mitigate the CPU stuck issue due to event windows don\(aqt
open up for a specified of time (i.e. notify\-window).
Default: notify\-vmexit=run,notify\-window=0.
.UNINDENT
.TP
.B \fB\-smp [[cpus=]n][,maxcpus=maxcpus][,sockets=sockets][,dies=dies][,clusters=clusters][,cores=cores][,threads=threads]\fP
Simulate a SMP system with \(aq\fBn\fP\(aq CPUs initially present on
the machine type board. On boards supporting CPU hotplug, the optional
\(aq\fBmaxcpus\fP\(aq parameter can be set to enable further CPUs to be
added at runtime. When both parameters are omitted, the maximum number
of CPUs will be calculated from the provided topology members and the
initial CPU count will match the maximum number. When only one of them
is given then the omitted one will be set to its counterpart\(aqs value.
Both parameters may be specified, but the maximum number of CPUs must
be equal to or greater than the initial CPU count. Product of the
CPU topology hierarchy must be equal to the maximum number of CPUs.
Both parameters are subject to an upper limit that is determined by
the specific machine type chosen.
.sp
To control reporting of CPU topology information, values of the topology
parameters can be specified. Machines may only support a subset of the
parameters and different machines may have different subsets supported
which vary depending on capacity of the corresponding CPU targets. So
for a particular machine type board, an expected topology hierarchy can
be defined through the supported sub\-option. Unsupported parameters can
also be provided in addition to the sub\-option, but their values must be
set as 1 in the purpose of correct parsing.
.sp
Either the initial CPU count, or at least one of the topology parameters
must be specified. The specified parameters must be greater than zero,
explicit configuration like "cpus=0" is not allowed. Values for any
omitted parameters will be computed from those which are given.
.sp
For example, the following sub\-option defines a CPU topology hierarchy
(2 sockets totally on the machine, 2 cores per socket, 2 threads per
core) for a machine that only supports sockets/cores/threads.
Some members of the option can be omitted but their values will be
automatically computed:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-smp 8,sockets=2,cores=2,threads=2,maxcpus=8
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
The following sub\-option defines a CPU topology hierarchy (2 sockets
totally on the machine, 2 dies per socket, 2 cores per die, 2 threads
per core) for PC machines which support sockets/dies/cores/threads.
Some members of the option can be omitted but their values will be
automatically computed:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-smp 16,sockets=2,dies=2,cores=2,threads=2,maxcpus=16
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
The following sub\-option defines a CPU topology hierarchy (2 sockets
totally on the machine, 2 clusters per socket, 2 cores per cluster,
2 threads per core) for ARM virt machines which support sockets/clusters
/cores/threads. Some members of the option can be omitted but their values
will be automatically computed:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-smp 16,sockets=2,clusters=2,cores=2,threads=2,maxcpus=16
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Historically preference was given to the coarsest topology parameters
when computing missing values (ie sockets preferred over cores, which
were preferred over threads), however, this behaviour is considered
liable to change. Prior to 6.2 the preference was sockets over cores
over threads. Since 6.2 the preference is cores over sockets over threads.
.sp
For example, the following option defines a machine board with 2 sockets
of 1 core before 6.2 and 1 socket of 2 cores after 6.2:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-smp 2
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-numa node[,mem=size][,cpus=firstcpu[\-lastcpu]][,nodeid=node][,initiator=initiator]\fP

.TP
.B \fB\-numa node[,memdev=id][,cpus=firstcpu[\-lastcpu]][,nodeid=node][,initiator=initiator]\fP

.TP
.B \fB\-numa dist,src=source,dst=destination,val=distance\fP

.TP
.B \fB\-numa cpu,node\-id=node[,socket\-id=x][,core\-id=y][,thread\-id=z]\fP

.TP
.B \fB\-numa hmat\-lb,initiator=node,target=node,hierarchy=hierarchy,data\-type=type[,latency=lat][,bandwidth=bw]\fP

.TP
.B \fB\-numa hmat\-cache,node\-id=node,size=size,level=level[,associativity=str][,policy=str][,line=size]\fP
Define a NUMA node and assign RAM and VCPUs to it. Set the NUMA
distance from a source node to a destination node. Set the ACPI
Heterogeneous Memory Attributes for the given nodes.
.sp
Legacy VCPU assignment uses \(aq\fBcpus\fP\(aq option where firstcpu and
lastcpu are CPU indexes. Each \(aq\fBcpus\fP\(aq option represent a
contiguous range of CPU indexes (or a single VCPU if lastcpu is
omitted). A non\-contiguous set of VCPUs can be represented by
providing multiple \(aq\fBcpus\fP\(aq options. If \(aq\fBcpus\fP\(aq is
omitted on all nodes, VCPUs are automatically split between them.
.sp
For example, the following option assigns VCPUs 0, 1, 2 and 5 to a
NUMA node:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-numa node,cpus=0\-2,cpus=5
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
\(aq\fBcpu\fP\(aq option is a new alternative to \(aq\fBcpus\fP\(aq option
which uses \(aq\fBsocket\-id|core\-id|thread\-id\fP\(aq properties to
assign CPU objects to a node using topology layout properties of
CPU. The set of properties is machine specific, and depends on used
machine type/\(aq\fBsmp\fP\(aq options. It could be queried with
\(aq\fBhotpluggable\-cpus\fP\(aq monitor command. \(aq\fBnode\-id\fP\(aq
property specifies node to which CPU object will be assigned, it\(aqs
required for node to be declared with \(aq\fBnode\fP\(aq option before
it\(aqs used with \(aq\fBcpu\fP\(aq option.
.sp
For example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-M pc \e
\-smp 1,sockets=2,maxcpus=2 \e
\-numa node,nodeid=0 \-numa node,nodeid=1 \e
\-numa cpu,node\-id=0,socket\-id=0 \-numa cpu,node\-id=1,socket\-id=1
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Legacy \(aq\fBmem\fP\(aq assigns a given RAM amount to a node (not supported
for 5.1 and newer machine types). \(aq\fBmemdev\fP\(aq assigns RAM from
a given memory backend device to a node. If \(aq\fBmem\fP\(aq and
\(aq\fBmemdev\fP\(aq are omitted in all nodes, RAM is split equally between them.
.sp
\(aq\fBmem\fP\(aq and \(aq\fBmemdev\fP\(aq are mutually exclusive.
Furthermore, if one node uses \(aq\fBmemdev\fP\(aq, all of them have to
use it.
.sp
\(aq\fBinitiator\fP\(aq is an additional option that points to an
initiator NUMA node that has best performance (the lowest latency or
largest bandwidth) to this NUMA node. Note that this option can be
set only when the machine property \(aqhmat\(aq is set to \(aqon\(aq.
.sp
Following example creates a machine with 2 NUMA nodes, node 0 has
CPU. node 1 has only memory, and its initiator is node 0. Note that
because node 0 has CPU, by default the initiator of node 0 is itself
and must be itself.
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-machine hmat=on \e
\-m 2G,slots=2,maxmem=4G \e
\-object memory\-backend\-ram,size=1G,id=m0 \e
\-object memory\-backend\-ram,size=1G,id=m1 \e
\-numa node,nodeid=0,memdev=m0 \e
\-numa node,nodeid=1,memdev=m1,initiator=0 \e
\-smp 2,sockets=2,maxcpus=2  \e
\-numa cpu,node\-id=0,socket\-id=0 \e
\-numa cpu,node\-id=0,socket\-id=1
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
source and destination are NUMA node IDs. distance is the NUMA
distance from source to destination. The distance from a node to
itself is always 10. If any pair of nodes is given a distance, then
all pairs must be given distances. Although, when distances are only
given in one direction for each pair of nodes, then the distances in
the opposite directions are assumed to be the same. If, however, an
asymmetrical pair of distances is given for even one node pair, then
all node pairs must be provided distance values for both directions,
even when they are symmetrical. When a node is unreachable from
another node, set the pair\(aqs distance to 255.
.sp
Note that the \-\fBnuma\fP option doesn\(aqt allocate any of the specified
resources, it just assigns existing resources to NUMA nodes. This
means that one still has to use the \fB\-m\fP, \fB\-smp\fP options to
allocate RAM and VCPUs respectively.
.sp
Use \(aq\fBhmat\-lb\fP\(aq to set System Locality Latency and Bandwidth
Information between initiator and target NUMA nodes in ACPI
Heterogeneous Attribute Memory Table (HMAT). Initiator NUMA node can
create memory requests, usually it has one or more processors.
Target NUMA node contains addressable memory.
.sp
In \(aq\fBhmat\-lb\fP\(aq option, node are NUMA node IDs. hierarchy is
the memory hierarchy of the target NUMA node: if hierarchy is
\(aqmemory\(aq, the structure represents the memory performance; if
hierarchy is \(aqfirst\-level|second\-level|third\-level\(aq, this
structure represents aggregated performance of memory side caches
for each domain. type of \(aqdata\-type\(aq is type of data represented by
this structure instance: if \(aqhierarchy\(aq is \(aqmemory\(aq, \(aqdata\-type\(aq is
\(aqaccess|read|write\(aq latency or \(aqaccess|read|write\(aq bandwidth of
the target memory; if \(aqhierarchy\(aq is
\(aqfirst\-level|second\-level|third\-level\(aq, \(aqdata\-type\(aq is
\(aqaccess|read|write\(aq hit latency or \(aqaccess|read|write\(aq hit
bandwidth of the target memory side cache.
.sp
lat is latency value in nanoseconds. bw is bandwidth value, the
possible value and units are NUM[M|G|T], mean that the bandwidth
value are NUM byte per second (or MB/s, GB/s or TB/s depending on
used suffix). Note that if latency or bandwidth value is 0, means
the corresponding latency or bandwidth information is not provided.
.sp
In \(aq\fBhmat\-cache\fP\(aq option, node\-id is the NUMA\-id of the memory
belongs. size is the size of memory side cache in bytes. level is
the cache level described in this structure, note that the cache
level 0 should not be used with \(aq\fBhmat\-cache\fP\(aq option.
associativity is the cache associativity, the possible value is
\(aqnone/direct(direct\-mapped)/complex(complex cache indexing)\(aq. policy
is the write policy. line is the cache Line size in bytes.
.sp
For example, the following options describe 2 NUMA nodes. Node 0 has
2 cpus and a ram, node 1 has only a ram. The processors in node 0
access memory in node 0 with access\-latency 5 nanoseconds,
access\-bandwidth is 200 MB/s; The processors in NUMA node 0 access
memory in NUMA node 1 with access\-latency 10 nanoseconds,
access\-bandwidth is 100 MB/s. And for memory side cache information,
NUMA node 0 and 1 both have 1 level memory cache, size is 10KB,
policy is write\-back, the cache Line size is 8 bytes:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-machine hmat=on \e
\-m 2G \e
\-object memory\-backend\-ram,size=1G,id=m0 \e
\-object memory\-backend\-ram,size=1G,id=m1 \e
\-smp 2,sockets=2,maxcpus=2 \e
\-numa node,nodeid=0,memdev=m0 \e
\-numa node,nodeid=1,memdev=m1,initiator=0 \e
\-numa cpu,node\-id=0,socket\-id=0 \e
\-numa cpu,node\-id=0,socket\-id=1 \e
\-numa hmat\-lb,initiator=0,target=0,hierarchy=memory,data\-type=access\-latency,latency=5 \e
\-numa hmat\-lb,initiator=0,target=0,hierarchy=memory,data\-type=access\-bandwidth,bandwidth=200M \e
\-numa hmat\-lb,initiator=0,target=1,hierarchy=memory,data\-type=access\-latency,latency=10 \e
\-numa hmat\-lb,initiator=0,target=1,hierarchy=memory,data\-type=access\-bandwidth,bandwidth=100M \e
\-numa hmat\-cache,node\-id=0,size=10K,level=1,associativity=direct,policy=write\-back,line=8 \e
\-numa hmat\-cache,node\-id=1,size=10K,level=1,associativity=direct,policy=write\-back,line=8
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-add\-fd fd=fd,set=set[,opaque=opaque]\fP
Add a file descriptor to an fd set. Valid options are:
.INDENT 7.0
.TP
.B \fBfd=fd\fP
This option defines the file descriptor of which a duplicate is
added to fd set. The file descriptor cannot be stdin, stdout, or
stderr.
.TP
.B \fBset=set\fP
This option defines the ID of the fd set to add the file
descriptor to.
.TP
.B \fBopaque=opaque\fP
This option defines a free\-form string that can be used to
describe fd.
.UNINDENT
.sp
You can open an image using pre\-opened file descriptors from an fd
set:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \e
 \-add\-fd fd=3,set=2,opaque="rdwr:/path/to/file" \e
 \-add\-fd fd=4,set=2,opaque="rdonly:/path/to/file" \e
 \-drive file=/dev/fdset/2,index=0,media=disk
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-set group.id.arg=value\fP
Set parameter arg for item id of type group
.TP
.B \fB\-global driver.prop=value\fP

.TP
.B \fB\-global driver=driver,property=property,value=value\fP
Set default value of driver\(aqs property prop to value, e.g.:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-global ide\-hd.physical_block_size=4096 disk\-image.img
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
In particular, you can use this to set driver properties for devices
which are created automatically by the machine model. To create a
device which is not created automatically and set properties on it,
use \-\fBdevice\fP\&.
.sp
\-global driver.prop=value is shorthand for \-global
driver=driver,property=prop,value=value. The longhand syntax works
even when driver contains a dot.
.TP
.B \fB\-boot [order=drives][,once=drives][,menu=on|off][,splash=sp_name][,splash\-time=sp_time][,reboot\-timeout=rb_timeout][,strict=on|off]\fP
Specify boot order drives as a string of drive letters. Valid drive
letters depend on the target architecture. The x86 PC uses: a, b
(floppy 1 and 2), c (first hard disk), d (first CD\-ROM), n\-p
(Etherboot from network adapter 1\-4), hard disk boot is the default.
To apply a particular boot order only on the first startup, specify
it via \fBonce\fP\&. Note that the \fBorder\fP or \fBonce\fP parameter
should not be used together with the \fBbootindex\fP property of
devices, since the firmware implementations normally do not support
both at the same time.
.sp
Interactive boot menus/prompts can be enabled via \fBmenu=on\fP as far
as firmware/BIOS supports them. The default is non\-interactive boot.
.sp
A splash picture could be passed to bios, enabling user to show it
as logo, when option splash=sp_name is given and menu=on, If
firmware/BIOS supports them. Currently Seabios for X86 system
support it. limitation: The splash file could be a jpeg file or a
BMP file in 24 BPP format(true color). The resolution should be
supported by the SVGA mode, so the recommended is 320x240, 640x480,
800x640.
.sp
A timeout could be passed to bios, guest will pause for rb_timeout
ms when boot failed, then reboot. If rb_timeout is \(aq\-1\(aq, guest will
not reboot, qemu passes \(aq\-1\(aq to bios by default. Currently Seabios
for X86 system support it.
.sp
Do strict boot via \fBstrict=on\fP as far as firmware/BIOS supports
it. This only effects when boot priority is changed by bootindex
options. The default is non\-strict boot.
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# try to boot from network first, then from hard disk
qemu\-system\-x86_64 \-boot order=nc
# boot from CD\-ROM first, switch back to default order after reboot
qemu\-system\-x86_64 \-boot once=d
# boot with a splash picture for 5 seconds.
qemu\-system\-x86_64 \-boot menu=on,splash=/root/boot.bmp,splash\-time=5000
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Note: The legacy format \(aq\-boot drives\(aq is still supported but its
use is discouraged as it may be removed from future versions.
.TP
.B \fB\-m [size=]megs[,slots=n,maxmem=size]\fP
Sets guest startup RAM size to megs megabytes. Default is 128 MiB.
Optionally, a suffix of "M" or "G" can be used to signify a value in
megabytes or gigabytes respectively. Optional pair slots, maxmem
could be used to set amount of hotpluggable memory slots and maximum
amount of memory. Note that maxmem must be aligned to the page size.
.sp
For example, the following command\-line sets the guest startup RAM
size to 1GB, creates 3 slots to hotplug additional memory and sets
the maximum memory the guest can reach to 4GB:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-m 1G,slots=3,maxmem=4G
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
If slots and maxmem are not specified, memory hotplug won\(aqt be
enabled and the guest startup RAM will never increase.
.TP
.B \fB\-mem\-path path\fP
Allocate guest RAM from a temporarily created file in path.
.TP
.B \fB\-mem\-prealloc\fP
Preallocate memory when using \-mem\-path.
.TP
.B \fB\-k language\fP
Use keyboard layout language (for example \fBfr\fP for French). This
option is only needed where it is not easy to get raw PC keycodes
(e.g. on Macs, with some X11 servers or with a VNC or curses
display). You don\(aqt normally need to use it on PC/Linux or
PC/Windows hosts.
.sp
The available layouts are:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
ar  de\-ch  es  fo     fr\-ca  hu  ja  mk     no  pt\-br  sv
da  en\-gb  et  fr     fr\-ch  is  lt  nl     pl  ru     th
de  en\-us  fi  fr\-be  hr     it  lv  nl\-be  pt  sl     tr
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
The default is \fBen\-us\fP\&.
.TP
.B \fB\-audio\-help\fP
Will show the \-audiodev equivalent of the currently specified
(deprecated) environment variables.
.TP
.B \fB\-audio [driver=]driver,model=value[,prop[=value][,...]]\fP
This option is a shortcut for configuring both the guest audio
hardware and the host audio backend in one go.
The driver option is the same as with the corresponding \fB\-audiodev\fP option below.
The guest hardware model can be set with \fBmodel=modelname\fP\&.
.sp
Use \fBdriver=help\fP to list the available drivers,
and \fBmodel=help\fP to list the available device types.
.sp
The following two example do exactly the same, to show how \fB\-audio\fP
can be used to shorten the command line length:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-audiodev pa,id=pa \-device sb16,audiodev=pa
qemu\-system\-x86_64 \-audio pa,model=sb16
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-audiodev [driver=]driver,id=id[,prop[=value][,...]]\fP
Adds a new audio backend driver identified by id. There are global
and driver specific properties. Some values can be set differently
for input and output, they\(aqre marked with \fBin|out.\fP\&. You can set
the input\(aqs property with \fBin.prop\fP and the output\(aqs property with
\fBout.prop\fP\&. For example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-audiodev alsa,id=example,in.frequency=44110,out.frequency=8000
\-audiodev alsa,id=example,out.channels=1 # leaves in.channels unspecified
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
NOTE: parameter validation is known to be incomplete, in many cases
specifying an invalid option causes QEMU to print an error message
and continue emulation without sound.
.sp
Valid global options are:
.INDENT 7.0
.TP
.B \fBid=identifier\fP
Identifies the audio backend.
.TP
.B \fBtimer\-period=period\fP
Sets the timer period used by the audio subsystem in
microseconds. Default is 10000 (10 ms).
.TP
.B \fBin|out.mixing\-engine=on|off\fP
Use QEMU\(aqs mixing engine to mix all streams inside QEMU and
convert audio formats when not supported by the backend. When
off, fixed\-settings must be off too. Note that disabling this
option means that the selected backend must support multiple
streams and the audio formats used by the virtual cards,
otherwise you\(aqll get no sound. It\(aqs not recommended to disable
this option unless you want to use 5.1 or 7.1 audio, as mixing
engine only supports mono and stereo audio. Default is on.
.TP
.B \fBin|out.fixed\-settings=on|off\fP
Use fixed settings for host audio. When off, it will change
based on how the guest opens the sound card. In this case you
must not specify frequency, channels or format. Default is on.
.TP
.B \fBin|out.frequency=frequency\fP
Specify the frequency to use when using fixed\-settings. Default
is 44100Hz.
.TP
.B \fBin|out.channels=channels\fP
Specify the number of channels to use when using fixed\-settings.
Default is 2 (stereo).
.TP
.B \fBin|out.format=format\fP
Specify the sample format to use when using fixed\-settings.
Valid values are: \fBs8\fP, \fBs16\fP, \fBs32\fP, \fBu8\fP, \fBu16\fP,
\fBu32\fP, \fBf32\fP\&. Default is \fBs16\fP\&.
.TP
.B \fBin|out.voices=voices\fP
Specify the number of voices to use. Default is 1.
.TP
.B \fBin|out.buffer\-length=usecs\fP
Sets the size of the buffer in microseconds.
.UNINDENT
.TP
.B \fB\-audiodev none,id=id[,prop[=value][,...]]\fP
Creates a dummy backend that discards all outputs. This backend has
no backend specific properties.
.TP
.B \fB\-audiodev alsa,id=id[,prop[=value][,...]]\fP
Creates backend using the ALSA. This backend is only available on
Linux.
.sp
ALSA specific options are:
.INDENT 7.0
.TP
.B \fBin|out.dev=device\fP
Specify the ALSA device to use for input and/or output. Default
is \fBdefault\fP\&.
.TP
.B \fBin|out.period\-length=usecs\fP
Sets the period length in microseconds.
.TP
.B \fBin|out.try\-poll=on|off\fP
Attempt to use poll mode with the device. Default is on.
.TP
.B \fBthreshold=threshold\fP
Threshold (in microseconds) when playback starts. Default is 0.
.UNINDENT
.TP
.B \fB\-audiodev coreaudio,id=id[,prop[=value][,...]]\fP
Creates a backend using Apple\(aqs Core Audio. This backend is only
available on Mac OS and only supports playback.
.sp
Core Audio specific options are:
.INDENT 7.0
.TP
.B \fBin|out.buffer\-count=count\fP
Sets the count of the buffers.
.UNINDENT
.TP
.B \fB\-audiodev dsound,id=id[,prop[=value][,...]]\fP
Creates a backend using Microsoft\(aqs DirectSound. This backend is
only available on Windows and only supports playback.
.sp
DirectSound specific options are:
.INDENT 7.0
.TP
.B \fBlatency=usecs\fP
Add extra usecs microseconds latency to playback. Default is
10000 (10 ms).
.UNINDENT
.TP
.B \fB\-audiodev oss,id=id[,prop[=value][,...]]\fP
Creates a backend using OSS. This backend is available on most
Unix\-like systems.
.sp
OSS specific options are:
.INDENT 7.0
.TP
.B \fBin|out.dev=device\fP
Specify the file name of the OSS device to use. Default is
\fB/dev/dsp\fP\&.
.TP
.B \fBin|out.buffer\-count=count\fP
Sets the count of the buffers.
.TP
.B \fBin|out.try\-poll=on|of\fP
Attempt to use poll mode with the device. Default is on.
.TP
.B \fBtry\-mmap=on|off\fP
Try using memory mapped device access. Default is off.
.TP
.B \fBexclusive=on|off\fP
Open the device in exclusive mode (vmix won\(aqt work in this
case). Default is off.
.TP
.B \fBdsp\-policy=policy\fP
Sets the timing policy (between 0 and 10, where smaller number
means smaller latency but higher CPU usage). Use \-1 to use
buffer sizes specified by \fBbuffer\fP and \fBbuffer\-count\fP\&. This
option is ignored if you do not have OSS 4. Default is 5.
.UNINDENT
.TP
.B \fB\-audiodev pa,id=id[,prop[=value][,...]]\fP
Creates a backend using PulseAudio. This backend is available on
most systems.
.sp
PulseAudio specific options are:
.INDENT 7.0
.TP
.B \fBserver=server\fP
Sets the PulseAudio server to connect to.
.TP
.B \fBin|out.name=sink\fP
Use the specified source/sink for recording/playback.
.TP
.B \fBin|out.latency=usecs\fP
Desired latency in microseconds. The PulseAudio server will try
to honor this value but actual latencies may be lower or higher.
.UNINDENT
.TP
.B \fB\-audiodev sdl,id=id[,prop[=value][,...]]\fP
Creates a backend using SDL. This backend is available on most
systems, but you should use your platform\(aqs native backend if
possible.
.sp
SDL specific options are:
.INDENT 7.0
.TP
.B \fBin|out.buffer\-count=count\fP
Sets the count of the buffers.
.UNINDENT
.TP
.B \fB\-audiodev sndio,id=id[,prop[=value][,...]]\fP
Creates a backend using SNDIO. This backend is available on
OpenBSD and most other Unix\-like systems.
.sp
Sndio specific options are:
.INDENT 7.0
.TP
.B \fBin|out.dev=device\fP
Specify the sndio device to use for input and/or output. Default
is \fBdefault\fP\&.
.TP
.B \fBin|out.latency=usecs\fP
Sets the desired period length in microseconds.
.UNINDENT
.TP
.B \fB\-audiodev spice,id=id[,prop[=value][,...]]\fP
Creates a backend that sends audio through SPICE. This backend
requires \fB\-spice\fP and automatically selected in that case, so
usually you can ignore this option. This backend has no backend
specific properties.
.TP
.B \fB\-audiodev wav,id=id[,prop[=value][,...]]\fP
Creates a backend that writes audio to a WAV file.
.sp
Backend specific options are:
.INDENT 7.0
.TP
.B \fBpath=path\fP
Write recorded audio into the specified file. Default is
\fBqemu.wav\fP\&.
.UNINDENT
.TP
.B \fB\-device driver[,prop[=value][,...]]\fP
Add device driver. prop=value sets driver properties. Valid
properties depend on the driver. To get help on possible drivers and
properties, use \fB\-device help\fP and \fB\-device driver,help\fP\&.
.sp
Some drivers are:
.TP
.B \fB\-device ipmi\-bmc\-sim,id=id[,prop[=value][,...]]\fP
Add an IPMI BMC. This is a simulation of a hardware management
interface processor that normally sits on a system. It provides a
watchdog and the ability to reset and power control the system. You
need to connect this to an IPMI interface to make it useful
.sp
The IPMI slave address to use for the BMC. The default is 0x20. This
address is the BMC\(aqs address on the I2C network of management
controllers. If you don\(aqt know what this means, it is safe to ignore
it.
.INDENT 7.0
.TP
.B \fBid=id\fP
The BMC id for interfaces to use this device.
.TP
.B \fBslave_addr=val\fP
Define slave address to use for the BMC. The default is 0x20.
.TP
.B \fBsdrfile=file\fP
file containing raw Sensor Data Records (SDR) data. The default
is none.
.TP
.B \fBfruareasize=val\fP
size of a Field Replaceable Unit (FRU) area. The default is
1024.
.TP
.B \fBfrudatafile=file\fP
file containing raw Field Replaceable Unit (FRU) inventory data.
The default is none.
.TP
.B \fBguid=uuid\fP
value for the GUID for the BMC, in standard UUID format. If this
is set, get "Get GUID" command to the BMC will return it.
Otherwise "Get GUID" will return an error.
.UNINDENT
.TP
.B \fB\-device ipmi\-bmc\-extern,id=id,chardev=id[,slave_addr=val]\fP
Add a connection to an external IPMI BMC simulator. Instead of
locally emulating the BMC like the above item, instead connect to an
external entity that provides the IPMI services.
.sp
A connection is made to an external BMC simulator. If you do this,
it is strongly recommended that you use the "reconnect=" chardev
option to reconnect to the simulator if the connection is lost. Note
that if this is not used carefully, it can be a security issue, as
the interface has the ability to send resets, NMIs, and power off
the VM. It\(aqs best if QEMU makes a connection to an external
simulator running on a secure port on localhost, so neither the
simulator nor QEMU is exposed to any outside network.
.sp
See the "lanserv/README.vm" file in the OpenIPMI library for more
details on the external interface.
.TP
.B \fB\-device isa\-ipmi\-kcs,bmc=id[,ioport=val][,irq=val]\fP
Add a KCS IPMI interface on the ISA bus. This also adds a
corresponding ACPI and SMBIOS entries, if appropriate.
.INDENT 7.0
.TP
.B \fBbmc=id\fP
The BMC to connect to, one of ipmi\-bmc\-sim or ipmi\-bmc\-extern
above.
.TP
.B \fBioport=val\fP
Define the I/O address of the interface. The default is 0xca0
for KCS.
.TP
.B \fBirq=val\fP
Define the interrupt to use. The default is 5. To disable
interrupts, set this to 0.
.UNINDENT
.TP
.B \fB\-device isa\-ipmi\-bt,bmc=id[,ioport=val][,irq=val]\fP
Like the KCS interface, but defines a BT interface. The default port
is 0xe4 and the default interrupt is 5.
.TP
.B \fB\-device pci\-ipmi\-kcs,bmc=id\fP
Add a KCS IPMI interface on the PCI bus.
.INDENT 7.0
.TP
.B \fBbmc=id\fP
The BMC to connect to, one of ipmi\-bmc\-sim or ipmi\-bmc\-extern above.
.UNINDENT
.TP
.B \fB\-device pci\-ipmi\-bt,bmc=id\fP
Like the KCS interface, but defines a BT interface on the PCI bus.
.TP
.B \fB\-device intel\-iommu[,option=...]\fP
This is only supported by \fB\-machine q35\fP, which will enable Intel VT\-d
emulation within the guest.  It supports below options:
.INDENT 7.0
.TP
.B \fBintremap=on|off\fP (default: auto)
This enables interrupt remapping feature.  It\(aqs required to enable
complete x2apic.  Currently it only supports kvm kernel\-irqchip modes
\fBoff\fP or \fBsplit\fP, while full kernel\-irqchip is not yet supported.
The default value is "auto", which will be decided by the mode of
kernel\-irqchip.
.TP
.B \fBcaching\-mode=on|off\fP (default: off)
This enables caching mode for the VT\-d emulated device.  When
caching\-mode is enabled, each guest DMA buffer mapping will generate an
IOTLB invalidation from the guest IOMMU driver to the vIOMMU device in
a synchronous way.  It is required for \fB\-device vfio\-pci\fP to work
with the VT\-d device, because host assigned devices requires to setup
the DMA mapping on the host before guest DMA starts.
.TP
.B \fBdevice\-iotlb=on|off\fP (default: off)
This enables device\-iotlb capability for the emulated VT\-d device.  So
far virtio/vhost should be the only real user for this parameter,
paired with ats=on configured for the device.
.TP
.B \fBaw\-bits=39|48\fP (default: 39)
This decides the address width of IOVA address space.  The address
space has 39 bits width for 3\-level IOMMU page tables, and 48 bits for
4\-level IOMMU page tables.
.UNINDENT
.sp
Please also refer to the wiki page for general scenarios of VT\-d
emulation in QEMU: \fI\%https://wiki.qemu.org/Features/VT\-d\fP\&.
.TP
.B \fB\-name name\fP
Sets the name of the guest. This name will be displayed in the SDL
window caption. The name will also be used for the VNC server. Also
optionally set the top visible process name in Linux. Naming of
individual threads can also be enabled on Linux to aid debugging.
.TP
.B \fB\-uuid uuid\fP
Set system UUID.
.UNINDENT
.SS Block device options
.sp
The QEMU block device handling options have a long history and
have gone through several iterations as the feature set and complexity
of the block layer have grown. Many online guides to QEMU often
reference older and deprecated options, which can lead to confusion.
.sp
The recommended modern way to describe disks is to use a combination of
\fB\-device\fP to specify the hardware device and \fB\-blockdev\fP to
describe the backend. The device defines what the guest sees and the
backend describes how QEMU handles the data.
.INDENT 0.0
.TP
.B \fB\-fda file\fP

.TP
.B \fB\-fdb file\fP
Use file as floppy disk 0/1 image (see the \fI\%Disk Images\fP chapter in
the System Emulation Users Guide).
.TP
.B \fB\-hda file\fP

.TP
.B \fB\-hdb file\fP

.TP
.B \fB\-hdc file\fP

.TP
.B \fB\-hdd file\fP
Use file as hard disk 0, 1, 2 or 3 image (see the \fI\%Disk Images\fP
chapter in the System Emulation Users Guide).
.TP
.B \fB\-cdrom file\fP
Use file as CD\-ROM image (you cannot use \fB\-hdc\fP and \fB\-cdrom\fP at
the same time). You can use the host CD\-ROM by using \fB/dev/cdrom\fP
as filename.
.TP
.B \fB\-blockdev option[,option[,option[,...]]]\fP
Define a new block driver node. Some of the options apply to all
block drivers, other options are only accepted for a specific block
driver. See below for a list of generic options and options for the
most common block drivers.
.sp
Options that expect a reference to another node (e.g. \fBfile\fP) can
be given in two ways. Either you specify the node name of an already
existing node (file=node\-name), or you define a new node inline,
adding options for the referenced node after a dot
(file.filename=path,file.aio=native).
.sp
A block driver node created with \fB\-blockdev\fP can be used for a
guest device by specifying its node name for the \fBdrive\fP property
in a \fB\-device\fP argument that defines a block device.
.INDENT 7.0
.TP
.B \fBValid options for any block driver node:\fP
.INDENT 7.0
.TP
.B \fBdriver\fP
Specifies the block driver to use for the given node.
.TP
.B \fBnode\-name\fP
This defines the name of the block driver node by which it
will be referenced later. The name must be unique, i.e. it
must not match the name of a different block driver node, or
(if you use \fB\-drive\fP as well) the ID of a drive.
.sp
If no node name is specified, it is automatically generated.
The generated node name is not intended to be predictable
and changes between QEMU invocations. For the top level, an
explicit node name must be specified.
.TP
.B \fBread\-only\fP
Open the node read\-only. Guest write attempts will fail.
.sp
Note that some block drivers support only read\-only access,
either generally or in certain configurations. In this case,
the default value \fBread\-only=off\fP does not work and the
option must be specified explicitly.
.TP
.B \fBauto\-read\-only\fP
If \fBauto\-read\-only=on\fP is set, QEMU may fall back to
read\-only usage even when \fBread\-only=off\fP is requested, or
even switch between modes as needed, e.g. depending on
whether the image file is writable or whether a writing user
is attached to the node.
.TP
.B \fBforce\-share\fP
Override the image locking system of QEMU by forcing the
node to utilize weaker shared access for permissions where
it would normally request exclusive access. When there is
the potential for multiple instances to have the same file
open (whether this invocation of QEMU is the first or the
second instance), both instances must permit shared access
for the second instance to succeed at opening the file.
.sp
Enabling \fBforce\-share=on\fP requires \fBread\-only=on\fP\&.
.TP
.B \fBcache.direct\fP
The host page cache can be avoided with \fBcache.direct=on\fP\&.
This will attempt to do disk IO directly to the guest\(aqs
memory. QEMU may still perform an internal copy of the data.
.TP
.B \fBcache.no\-flush\fP
In case you don\(aqt care about data integrity over host
failures, you can use \fBcache.no\-flush=on\fP\&. This option
tells QEMU that it never needs to write any data to the disk
but can instead keep things in cache. If anything goes
wrong, like your host losing power, the disk storage getting
disconnected accidentally, etc. your image will most
probably be rendered unusable.
.TP
.B \fBdiscard=discard\fP
discard is one of "ignore" (or "off") or "unmap" (or "on")
and controls whether \fBdiscard\fP (also known as \fBtrim\fP or
\fBunmap\fP) requests are ignored or passed to the filesystem.
Some machine types may not support discard requests.
.TP
.B \fBdetect\-zeroes=detect\-zeroes\fP
detect\-zeroes is "off", "on" or "unmap" and enables the
automatic conversion of plain zero writes by the OS to
driver specific optimized zero write commands. You may even
choose "unmap" if discard is set to "unmap" to allow a zero
write to be converted to an \fBunmap\fP operation.
.UNINDENT
.TP
.B \fBDriver\-specific options for file\fP
This is the protocol\-level block driver for accessing regular
files.
.INDENT 7.0
.TP
.B \fBfilename\fP
The path to the image file in the local filesystem
.TP
.B \fBaio\fP
Specifies the AIO backend (threads/native/io_uring,
default: threads)
.TP
.B \fBlocking\fP
Specifies whether the image file is protected with Linux OFD
/ POSIX locks. The default is to use the Linux Open File
Descriptor API if available, otherwise no lock is applied.
(auto/on/off, default: auto)
.UNINDENT
.sp
Example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-blockdev driver=file,node\-name=disk,filename=disk.img
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBDriver\-specific options for raw\fP
This is the image format block driver for raw images. It is
usually stacked on top of a protocol level block driver such as
\fBfile\fP\&.
.INDENT 7.0
.TP
.B \fBfile\fP
Reference to or definition of the data source block driver
node (e.g. a \fBfile\fP driver node)
.UNINDENT
.sp
Example 1:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-blockdev driver=file,node\-name=disk_file,filename=disk.img
\-blockdev driver=raw,node\-name=disk,file=disk_file
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example 2:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-blockdev driver=raw,node\-name=disk,file.driver=file,file.filename=disk.img
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBDriver\-specific options for qcow2\fP
This is the image format block driver for qcow2 images. It is
usually stacked on top of a protocol level block driver such as
\fBfile\fP\&.
.INDENT 7.0
.TP
.B \fBfile\fP
Reference to or definition of the data source block driver
node (e.g. a \fBfile\fP driver node)
.TP
.B \fBbacking\fP
Reference to or definition of the backing file block device
(default is taken from the image file). It is allowed to
pass \fBnull\fP here in order to disable the default backing
file.
.TP
.B \fBlazy\-refcounts\fP
Whether to enable the lazy refcounts feature (on/off;
default is taken from the image file)
.TP
.B \fBcache\-size\fP
The maximum total size of the L2 table and refcount block
caches in bytes (default: the sum of l2\-cache\-size and
refcount\-cache\-size)
.TP
.B \fBl2\-cache\-size\fP
The maximum size of the L2 table cache in bytes (default: if
cache\-size is not specified \- 32M on Linux platforms, and 8M
on non\-Linux platforms; otherwise, as large as possible
within the cache\-size, while permitting the requested or the
minimal refcount cache size)
.TP
.B \fBrefcount\-cache\-size\fP
The maximum size of the refcount block cache in bytes
(default: 4 times the cluster size; or if cache\-size is
specified, the part of it which is not used for the L2
cache)
.TP
.B \fBcache\-clean\-interval\fP
Clean unused entries in the L2 and refcount caches. The
interval is in seconds. The default value is 600 on
supporting platforms, and 0 on other platforms. Setting it
to 0 disables this feature.
.TP
.B \fBpass\-discard\-request\fP
Whether discard requests to the qcow2 device should be
forwarded to the data source (on/off; default: on if
discard=unmap is specified, off otherwise)
.TP
.B \fBpass\-discard\-snapshot\fP
Whether discard requests for the data source should be
issued when a snapshot operation (e.g. deleting a snapshot)
frees clusters in the qcow2 file (on/off; default: on)
.TP
.B \fBpass\-discard\-other\fP
Whether discard requests for the data source should be
issued on other occasions where a cluster gets freed
(on/off; default: off)
.TP
.B \fBoverlap\-check\fP
Which overlap checks to perform for writes to the image
(none/constant/cached/all; default: cached). For details or
finer granularity control refer to the QAPI documentation of
\fBblockdev\-add\fP\&.
.UNINDENT
.sp
Example 1:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-blockdev driver=file,node\-name=my_file,filename=/tmp/disk.qcow2
\-blockdev driver=qcow2,node\-name=hda,file=my_file,overlap\-check=none,cache\-size=16777216
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example 2:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-blockdev driver=qcow2,node\-name=disk,file.driver=http,file.filename=http://example.com/image.qcow2
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBDriver\-specific options for other drivers\fP
Please refer to the QAPI documentation of the \fBblockdev\-add\fP
QMP command.
.UNINDENT
.TP
.B \fB\-drive option[,option[,option[,...]]]\fP
Define a new drive. This includes creating a block driver node (the
backend) as well as a guest device, and is mostly a shortcut for
defining the corresponding \fB\-blockdev\fP and \fB\-device\fP options.
.sp
\fB\-drive\fP accepts all options that are accepted by \fB\-blockdev\fP\&.
In addition, it knows the following options:
.INDENT 7.0
.TP
.B \fBfile=file\fP
This option defines which disk image (see the \fI\%Disk Images\fP
chapter in the System Emulation Users Guide) to use with this drive.
If the filename contains comma, you must double it (for instance,
"file=my,,file" to use file "my,file").
.sp
Special files such as iSCSI devices can be specified using
protocol specific URLs. See the section for "Device URL Syntax"
for more information.
.TP
.B \fBif=interface\fP
This option defines on which type on interface the drive is
connected. Available types are: ide, scsi, sd, mtd, floppy,
pflash, virtio, none.
.TP
.B \fBbus=bus,unit=unit\fP
These options define where is connected the drive by defining
the bus number and the unit id.
.TP
.B \fBindex=index\fP
This option defines where the drive is connected by using an
index in the list of available connectors of a given interface
type.
.TP
.B \fBmedia=media\fP
This option defines the type of the media: disk or cdrom.
.TP
.B \fBsnapshot=snapshot\fP
snapshot is "on" or "off" and controls snapshot mode for the
given drive (see \fB\-snapshot\fP).
.TP
.B \fBcache=cache\fP
cache is "none", "writeback", "unsafe", "directsync" or
"writethrough" and controls how the host cache is used to access
block data. This is a shortcut that sets the \fBcache.direct\fP
and \fBcache.no\-flush\fP options (as in \fB\-blockdev\fP), and
additionally \fBcache.writeback\fP, which provides a default for
the \fBwrite\-cache\fP option of block guest devices (as in
\fB\-device\fP). The modes correspond to the following settings:
.TS
center;
|l|l|l|l|.
_
T{

T}	T{
cache.writeback
T}	T{
cache.direct
T}	T{
cache.no\-flush
T}
_
T{
writeback
T}	T{
on
T}	T{
off
T}	T{
off
T}
_
T{
none
T}	T{
on
T}	T{
on
T}	T{
off
T}
_
T{
writethrough
T}	T{
off
T}	T{
off
T}	T{
off
T}
_
T{
directsync
T}	T{
off
T}	T{
on
T}	T{
off
T}
_
T{
unsafe
T}	T{
on
T}	T{
off
T}	T{
on
T}
_
.TE
.sp
The default mode is \fBcache=writeback\fP\&.
.TP
.B \fBaio=aio\fP
aio is "threads", "native", or "io_uring" and selects between pthread
based disk I/O, native Linux AIO, or Linux io_uring API.
.TP
.B \fBformat=format\fP
Specify which disk format will be used rather than detecting the
format. Can be used to specify format=raw to avoid interpreting
an untrusted format header.
.TP
.B \fBwerror=action,rerror=action\fP
Specify which action to take on write and read errors. Valid
actions are: "ignore" (ignore the error and try to continue),
"stop" (pause QEMU), "report" (report the error to the guest),
"enospc" (pause QEMU only if the host disk is full; report the
error to the guest otherwise). The default setting is
\fBwerror=enospc\fP and \fBrerror=report\fP\&.
.TP
.B \fBcopy\-on\-read=copy\-on\-read\fP
copy\-on\-read is "on" or "off" and enables whether to copy read
backing file sectors into the image file.
.TP
.B \fBbps=b,bps_rd=r,bps_wr=w\fP
Specify bandwidth throttling limits in bytes per second, either
for all request types or for reads or writes only. Small values
can lead to timeouts or hangs inside the guest. A safe minimum
for disks is 2 MB/s.
.TP
.B \fBbps_max=bm,bps_rd_max=rm,bps_wr_max=wm\fP
Specify bursts in bytes per second, either for all request types
or for reads or writes only. Bursts allow the guest I/O to spike
above the limit temporarily.
.TP
.B \fBiops=i,iops_rd=r,iops_wr=w\fP
Specify request rate limits in requests per second, either for
all request types or for reads or writes only.
.TP
.B \fBiops_max=bm,iops_rd_max=rm,iops_wr_max=wm\fP
Specify bursts in requests per second, either for all request
types or for reads or writes only. Bursts allow the guest I/O to
spike above the limit temporarily.
.TP
.B \fBiops_size=is\fP
Let every is bytes of a request count as a new request for iops
throttling purposes. Use this option to prevent guests from
circumventing iops limits by sending fewer but larger requests.
.TP
.B \fBgroup=g\fP
Join a throttling quota group with given name g. All drives that
are members of the same group are accounted for together. Use
this option to prevent guests from circumventing throttling
limits by using many small disks instead of a single larger
disk.
.UNINDENT
.sp
By default, the \fBcache.writeback=on\fP mode is used. It will report
data writes as completed as soon as the data is present in the host
page cache. This is safe as long as your guest OS makes sure to
correctly flush disk caches where needed. If your guest OS does not
handle volatile disk write caches correctly and your host crashes or
loses power, then the guest may experience data corruption.
.sp
For such guests, you should consider using \fBcache.writeback=off\fP\&.
This means that the host page cache will be used to read and write
data, but write notification will be sent to the guest only after
QEMU has made sure to flush each write to the disk. Be aware that
this has a major impact on performance.
.sp
When using the \fB\-snapshot\fP option, unsafe caching is always used.
.sp
Copy\-on\-read avoids accessing the same backing file sectors
repeatedly and is useful when the backing file is over a slow
network. By default copy\-on\-read is off.
.sp
Instead of \fB\-cdrom\fP you can use:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-drive file=file,index=2,media=cdrom
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Instead of \fB\-hda\fP, \fB\-hdb\fP, \fB\-hdc\fP, \fB\-hdd\fP, you can use:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-drive file=file,index=0,media=disk
qemu\-system\-x86_64 \-drive file=file,index=1,media=disk
qemu\-system\-x86_64 \-drive file=file,index=2,media=disk
qemu\-system\-x86_64 \-drive file=file,index=3,media=disk
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
You can open an image using pre\-opened file descriptors from an fd
set:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \e
 \-add\-fd fd=3,set=2,opaque="rdwr:/path/to/file" \e
 \-add\-fd fd=4,set=2,opaque="rdonly:/path/to/file" \e
 \-drive file=/dev/fdset/2,index=0,media=disk
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
You can connect a CDROM to the slave of ide0:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-drive file=file,if=ide,index=1,media=cdrom
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
If you don\(aqt specify the "file=" argument, you define an empty
drive:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-drive if=ide,index=1,media=cdrom
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Instead of \fB\-fda\fP, \fB\-fdb\fP, you can use:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-drive file=file,index=0,if=floppy
qemu\-system\-x86_64 \-drive file=file,index=1,if=floppy
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
By default, interface is "ide" and index is automatically
incremented:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-drive file=a \-drive file=b"
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
is interpreted like:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-hda a \-hdb b
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-mtdblock file\fP
Use file as on\-board Flash memory image.
.TP
.B \fB\-sd file\fP
Use file as SecureDigital card image.
.TP
.B \fB\-snapshot\fP
Write to temporary files instead of disk image files. In this case,
the raw disk image you use is not written back. You can however
force the write back by pressing C\-a s (see the \fI\%Disk Images\fP
chapter in the System Emulation Users Guide).
.TP
.B \fB\-fsdev local,id=id,path=path,security_model=security_model [,writeout=writeout][,readonly=on][,fmode=fmode][,dmode=dmode] [,throttling.option=value[,throttling.option=value[,...]]]\fP

.TP
.B \fB\-fsdev proxy,id=id,socket=socket[,writeout=writeout][,readonly=on]\fP

.TP
.B \fB\-fsdev proxy,id=id,sock_fd=sock_fd[,writeout=writeout][,readonly=on]\fP

.TP
.B \fB\-fsdev synth,id=id[,readonly=on]\fP
Define a new file system device. Valid options are:
.INDENT 7.0
.TP
.B \fBlocal\fP
Accesses to the filesystem are done by QEMU.
.TP
.B \fBproxy\fP
Accesses to the filesystem are done by virtfs\-proxy\-helper(1).
.TP
.B \fBsynth\fP
Synthetic filesystem, only used by QTests.
.TP
.B \fBid=id\fP
Specifies identifier for this device.
.TP
.B \fBpath=path\fP
Specifies the export path for the file system device. Files
under this path will be available to the 9p client on the guest.
.TP
.B \fBsecurity_model=security_model\fP
Specifies the security model to be used for this export path.
Supported security models are "passthrough", "mapped\-xattr",
"mapped\-file" and "none". In "passthrough" security model, files
are stored using the same credentials as they are created on the
guest. This requires QEMU to run as root. In "mapped\-xattr"
security model, some of the file attributes like uid, gid, mode
bits and link target are stored as file attributes. For
"mapped\-file" these attributes are stored in the hidden
\&.virtfs_metadata directory. Directories exported by this
security model cannot interact with other unix tools. "none"
security model is same as passthrough except the sever won\(aqt
report failures if it fails to set file attributes like
ownership. Security model is mandatory only for local fsdriver.
Other fsdrivers (like proxy) don\(aqt take security model as a
parameter.
.TP
.B \fBwriteout=writeout\fP
This is an optional argument. The only supported value is
"immediate". This means that host page cache will be used to
read and write data but write notification will be sent to the
guest only when the data has been reported as written by the
storage subsystem.
.TP
.B \fBreadonly=on\fP
Enables exporting 9p share as a readonly mount for guests. By
default read\-write access is given.
.TP
.B \fBsocket=socket\fP
Enables proxy filesystem driver to use passed socket file for
communicating with virtfs\-proxy\-helper(1).
.TP
.B \fBsock_fd=sock_fd\fP
Enables proxy filesystem driver to use passed socket descriptor
for communicating with virtfs\-proxy\-helper(1). Usually a helper
like libvirt will create socketpair and pass one of the fds as
sock_fd.
.TP
.B \fBfmode=fmode\fP
Specifies the default mode for newly created files on the host.
Works only with security models "mapped\-xattr" and
"mapped\-file".
.TP
.B \fBdmode=dmode\fP
Specifies the default mode for newly created directories on the
host. Works only with security models "mapped\-xattr" and
"mapped\-file".
.TP
.B \fBthrottling.bps\-total=b,throttling.bps\-read=r,throttling.bps\-write=w\fP
Specify bandwidth throttling limits in bytes per second, either
for all request types or for reads or writes only.
.TP
.B \fBthrottling.bps\-total\-max=bm,bps\-read\-max=rm,bps\-write\-max=wm\fP
Specify bursts in bytes per second, either for all request types
or for reads or writes only. Bursts allow the guest I/O to spike
above the limit temporarily.
.TP
.B \fBthrottling.iops\-total=i,throttling.iops\-read=r, throttling.iops\-write=w\fP
Specify request rate limits in requests per second, either for
all request types or for reads or writes only.
.TP
.B \fBthrottling.iops\-total\-max=im,throttling.iops\-read\-max=irm, throttling.iops\-write\-max=iwm\fP
Specify bursts in requests per second, either for all request
types or for reads or writes only. Bursts allow the guest I/O to
spike above the limit temporarily.
.TP
.B \fBthrottling.iops\-size=is\fP
Let every is bytes of a request count as a new request for iops
throttling purposes.
.UNINDENT
.sp
\-fsdev option is used along with \-device driver "virtio\-9p\-...".
.TP
.B \fB\-device virtio\-9p\-type,fsdev=id,mount_tag=mount_tag\fP
Options for virtio\-9p\-... driver are:
.INDENT 7.0
.TP
.B \fBtype\fP
Specifies the variant to be used. Supported values are "pci",
"ccw" or "device", depending on the machine type.
.TP
.B \fBfsdev=id\fP
Specifies the id value specified along with \-fsdev option.
.TP
.B \fBmount_tag=mount_tag\fP
Specifies the tag name to be used by the guest to mount this
export point.
.UNINDENT
.TP
.B \fB\-virtfs local,path=path,mount_tag=mount_tag ,security_model=security_model[,writeout=writeout][,readonly=on] [,fmode=fmode][,dmode=dmode][,multidevs=multidevs]\fP

.TP
.B \fB\-virtfs proxy,socket=socket,mount_tag=mount_tag [,writeout=writeout][,readonly=on]\fP

.TP
.B \fB\-virtfs proxy,sock_fd=sock_fd,mount_tag=mount_tag [,writeout=writeout][,readonly=on]\fP

.TP
.B \fB\-virtfs synth,mount_tag=mount_tag\fP
Define a new virtual filesystem device and expose it to the guest using
a virtio\-9p\-device (a.k.a. 9pfs), which essentially means that a certain
directory on host is made directly accessible by guest as a pass\-through
file system by using the 9P network protocol for communication between
host and guests, if desired even accessible, shared by several guests
simultaneously.
.sp
Note that \fB\-virtfs\fP is actually just a convenience shortcut for its
generalized form \fB\-fsdev \-device virtio\-9p\-pci\fP\&.
.sp
The general form of pass\-through file system options are:
.INDENT 7.0
.TP
.B \fBlocal\fP
Accesses to the filesystem are done by QEMU.
.TP
.B \fBproxy\fP
Accesses to the filesystem are done by virtfs\-proxy\-helper(1).
.TP
.B \fBsynth\fP
Synthetic filesystem, only used by QTests.
.TP
.B \fBid=id\fP
Specifies identifier for the filesystem device
.TP
.B \fBpath=path\fP
Specifies the export path for the file system device. Files
under this path will be available to the 9p client on the guest.
.TP
.B \fBsecurity_model=security_model\fP
Specifies the security model to be used for this export path.
Supported security models are "passthrough", "mapped\-xattr",
"mapped\-file" and "none". In "passthrough" security model, files
are stored using the same credentials as they are created on the
guest. This requires QEMU to run as root. In "mapped\-xattr"
security model, some of the file attributes like uid, gid, mode
bits and link target are stored as file attributes. For
"mapped\-file" these attributes are stored in the hidden
\&.virtfs_metadata directory. Directories exported by this
security model cannot interact with other unix tools. "none"
security model is same as passthrough except the sever won\(aqt
report failures if it fails to set file attributes like
ownership. Security model is mandatory only for local fsdriver.
Other fsdrivers (like proxy) don\(aqt take security model as a
parameter.
.TP
.B \fBwriteout=writeout\fP
This is an optional argument. The only supported value is
"immediate". This means that host page cache will be used to
read and write data but write notification will be sent to the
guest only when the data has been reported as written by the
storage subsystem.
.TP
.B \fBreadonly=on\fP
Enables exporting 9p share as a readonly mount for guests. By
default read\-write access is given.
.TP
.B \fBsocket=socket\fP
Enables proxy filesystem driver to use passed socket file for
communicating with virtfs\-proxy\-helper(1). Usually a helper like
libvirt will create socketpair and pass one of the fds as
sock_fd.
.TP
.B \fBsock_fd\fP
Enables proxy filesystem driver to use passed \(aqsock_fd\(aq as the
socket descriptor for interfacing with virtfs\-proxy\-helper(1).
.TP
.B \fBfmode=fmode\fP
Specifies the default mode for newly created files on the host.
Works only with security models "mapped\-xattr" and
"mapped\-file".
.TP
.B \fBdmode=dmode\fP
Specifies the default mode for newly created directories on the
host. Works only with security models "mapped\-xattr" and
"mapped\-file".
.TP
.B \fBmount_tag=mount_tag\fP
Specifies the tag name to be used by the guest to mount this
export point.
.TP
.B \fBmultidevs=multidevs\fP
Specifies how to deal with multiple devices being shared with a
9p export. Supported behaviours are either "remap", "forbid" or
"warn". The latter is the default behaviour on which virtfs 9p
expects only one device to be shared with the same export, and
if more than one device is shared and accessed via the same 9p
export then only a warning message is logged (once) by qemu on
host side. In order to avoid file ID collisions on guest you
should either create a separate virtfs export for each device to
be shared with guests (recommended way) or you might use "remap"
instead which allows you to share multiple devices with only one
export instead, which is achieved by remapping the original
inode numbers from host to guest in a way that would prevent
such collisions. Remapping inodes in such use cases is required
because the original device IDs from host are never passed and
exposed on guest. Instead all files of an export shared with
virtfs always share the same device id on guest. So two files
with identical inode numbers but from actually different devices
on host would otherwise cause a file ID collision and hence
potential misbehaviours on guest. "forbid" on the other hand
assumes like "warn" that only one device is shared by the same
export, however it will not only log a warning message but also
deny access to additional devices on guest. Note though that
"forbid" does currently not block all possible file access
operations (e.g. readdir() would still return entries from other
devices).
.UNINDENT
.TP
.B \fB\-iscsi\fP
Configure iSCSI session parameters.
.UNINDENT
.SS USB convenience options
.INDENT 0.0
.TP
.B \fB\-usb\fP
Enable USB emulation on machine types with an on\-board USB host
controller (if not enabled by default). Note that on\-board USB host
controllers may not support USB 3.0. In this case
\fB\-device qemu\-xhci\fP can be used instead on machines with PCI.
.TP
.B \fB\-usbdevice devname\fP
Add the USB device devname, and enable an on\-board USB controller
if possible and necessary (just like it can be done via
\fB\-machine usb=on\fP). Note that this option is mainly intended for
the user\(aqs convenience only. More fine\-grained control can be
achieved by selecting a USB host controller (if necessary) and the
desired USB device via the \fB\-device\fP option instead. For example,
instead of using \fB\-usbdevice mouse\fP it is possible to use
\fB\-device qemu\-xhci \-device usb\-mouse\fP to connect the USB mouse
to a USB 3.0 controller instead (at least on machines that support
PCI and do not have an USB controller enabled by default yet).
For more details, see the chapter about
\fI\%Connecting USB devices\fP in the System Emulation Users Guide.
Possible devices for devname are:
.INDENT 7.0
.TP
.B \fBbraille\fP
Braille device. This will use BrlAPI to display the braille
output on a real or fake device (i.e. it also creates a
corresponding \fBbraille\fP chardev automatically beside the
\fBusb\-braille\fP USB device).
.TP
.B \fBkeyboard\fP
Standard USB keyboard. Will override the PS/2 keyboard (if present).
.TP
.B \fBmouse\fP
Virtual Mouse. This will override the PS/2 mouse emulation when
activated.
.TP
.B \fBtablet\fP
Pointer device that uses absolute coordinates (like a
touchscreen). This means QEMU is able to report the mouse
position without having to grab the mouse. Also overrides the
PS/2 mouse emulation when activated.
.TP
.B \fBwacom\-tablet\fP
Wacom PenPartner USB tablet.
.UNINDENT
.UNINDENT
.SS Display options
.INDENT 0.0
.TP
.B \fB\-display type\fP
Select type of display to use. Use \fB\-display help\fP to list the available
display types. Valid values for type are
.INDENT 7.0
.TP
.B \fBspice\-app[,gl=on|off]\fP
Start QEMU as a Spice server and launch the default Spice client
application. The Spice server will redirect the serial consoles
and QEMU monitors. (Since 4.0)
.TP
.B \fBdbus\fP
Export the display over D\-Bus interfaces. (Since 7.0)
.sp
The connection is registered with the "org.qemu" name (and queued when
already owned).
.sp
\fBaddr=<dbusaddr>\fP : D\-Bus bus address to connect to.
.sp
\fBp2p=yes|no\fP : Use peer\-to\-peer connection, accepted via QMP \fBadd_client\fP\&.
.sp
\fBgl=on|off|core|es\fP : Use OpenGL for rendering (the D\-Bus interface
will share framebuffers with DMABUF file descriptors).
.TP
.B \fBsdl\fP
Display video output via SDL (usually in a separate graphics
window; see the SDL documentation for other possibilities).
Valid parameters are:
.sp
\fBgrab\-mod=<mods>\fP : Used to select the modifier keys for toggling
the mouse grabbing in conjunction with the "g" key. \fB<mods>\fP can be
either \fBlshift\-lctrl\-lalt\fP or \fBrctrl\fP\&.
.sp
\fBgl=on|off|core|es\fP : Use OpenGL for displaying
.sp
\fBshow\-cursor=on|off\fP :  Force showing the mouse cursor
.sp
\fBwindow\-close=on|off\fP : Allow to quit qemu with window close button
.TP
.B \fBgtk\fP
Display video output in a GTK window. This interface provides
drop\-down menus and other UI elements to configure and control
the VM during runtime. Valid parameters are:
.sp
\fBfull\-screen=on|off\fP : Start in fullscreen mode
.sp
\fBgl=on|off\fP : Use OpenGL for displaying
.sp
\fBgrab\-on\-hover=on|off\fP : Grab keyboard input on mouse hover
.INDENT 7.0
.TP
.B \fBshow\-tabs=on|off\fP
Display the tab bar for switching between the
various graphical interfaces (e.g. VGA and
virtual console character devices) by default.
.UNINDENT
.sp
\fBshow\-cursor=on|off\fP :  Force showing the mouse cursor
.sp
\fBwindow\-close=on|off\fP : Allow to quit qemu with window close button
.sp
\fBshow\-menubar=on|off\fP : Display the main window menubar, defaults to "on"
.TP
.B \fBcurses[,charset=<encoding>]\fP
Display video output via curses. For graphics device models
which support a text mode, QEMU can display this output using a
curses/ncurses interface. Nothing is displayed when the graphics
device is in graphical mode or if the graphics device does not
support a text mode. Generally only the VGA device models
support text mode. The font charset used by the guest can be
specified with the \fBcharset\fP option, for example
\fBcharset=CP850\fP for IBM CP850 encoding. The default is
\fBCP437\fP\&.
.TP
.B \fBcocoa\fP
Display video output in a Cocoa window. Mac only. This interface
provides drop\-down menus and other UI elements to configure and
control the VM during runtime. Valid parameters are:
.sp
\fBshow\-cursor=on|off\fP :  Force showing the mouse cursor
.sp
\fBleft\-command\-key=on|off\fP : Disable forwarding left command key to host
.TP
.B \fBegl\-headless[,rendernode=<file>]\fP
Offload all OpenGL operations to a local DRI device. For any
graphical display, this display needs to be paired with either
VNC or SPICE displays.
.TP
.B \fBvnc=<display>\fP
Start a VNC server on display <display>
.TP
.B \fBnone\fP
Do not display video output. The guest will still see an
emulated graphics card, but its output will not be displayed to
the QEMU user. This option differs from the \-nographic option in
that it only affects what is done with video output; \-nographic
also changes the destination of the serial and parallel port
data.
.UNINDENT
.TP
.B \fB\-nographic\fP
Normally, if QEMU is compiled with graphical window support, it
displays output such as guest graphics, guest console, and the QEMU
monitor in a window. With this option, you can totally disable
graphical output so that QEMU is a simple command line application.
The emulated serial port is redirected on the console and muxed with
the monitor (unless redirected elsewhere explicitly). Therefore, you
can still use QEMU to debug a Linux kernel with a serial console.
Use C\-a h for help on switching between the console and monitor.
.TP
.B \fB\-spice option[,option[,...]]\fP
Enable the spice remote desktop protocol. Valid options are
.INDENT 7.0
.TP
.B \fBport=<nr>\fP
Set the TCP port spice is listening on for plaintext channels.
.TP
.B \fBaddr=<addr>\fP
Set the IP address spice is listening on. Default is any
address.
.TP
.B \fBipv4=on|off\fP; \fBipv6=on|off\fP; \fBunix=on|off\fP
Force using the specified IP version.
.TP
.B \fBpassword=<string>\fP
Set the password you need to authenticate.
.sp
This option is deprecated and insecure because it leaves the
password visible in the process listing. Use \fBpassword\-secret\fP
instead.
.TP
.B \fBpassword\-secret=<secret\-id>\fP
Set the ID of the \fBsecret\fP object containing the password
you need to authenticate.
.TP
.B \fBsasl=on|off\fP
Require that the client use SASL to authenticate with the spice.
The exact choice of authentication method used is controlled
from the system / user\(aqs SASL configuration file for the \(aqqemu\(aq
service. This is typically found in /etc/sasl2/qemu.conf. If
running QEMU as an unprivileged user, an environment variable
SASL_CONF_PATH can be used to make it search alternate
locations for the service config. While some SASL auth methods
can also provide data encryption (eg GSSAPI), it is recommended
that SASL always be combined with the \(aqtls\(aq and \(aqx509\(aq settings
to enable use of SSL and server certificates. This ensures a
data encryption preventing compromise of authentication
credentials.
.TP
.B \fBdisable\-ticketing=on|off\fP
Allow client connects without authentication.
.TP
.B \fBdisable\-copy\-paste=on|off\fP
Disable copy paste between the client and the guest.
.TP
.B \fBdisable\-agent\-file\-xfer=on|off\fP
Disable spice\-vdagent based file\-xfer between the client and the
guest.
.TP
.B \fBtls\-port=<nr>\fP
Set the TCP port spice is listening on for encrypted channels.
.TP
.B \fBx509\-dir=<dir>\fP
Set the x509 file directory. Expects same filenames as \-vnc
$display,x509=$dir
.TP
.B \fBx509\-key\-file=<file>\fP; \fBx509\-key\-password=<file>\fP; \fBx509\-cert\-file=<file>\fP; \fBx509\-cacert\-file=<file>\fP; \fBx509\-dh\-key\-file=<file>\fP
The x509 file names can also be configured individually.
.TP
.B \fBtls\-ciphers=<list>\fP
Specify which ciphers to use.
.TP
.B \fBtls\-channel=[main|display|cursor|inputs|record|playback]\fP; \fBplaintext\-channel=[main|display|cursor|inputs|record|playback]\fP
Force specific channel to be used with or without TLS
encryption. The options can be specified multiple times to
configure multiple channels. The special name "default" can be
used to set the default mode. For channels which are not
explicitly forced into one mode the spice client is allowed to
pick tls/plaintext as he pleases.
.TP
.B \fBimage\-compression=[auto_glz|auto_lz|quic|glz|lz|off]\fP
Configure image compression (lossless). Default is auto_glz.
.TP
.B \fBjpeg\-wan\-compression=[auto|never|always]\fP; \fBzlib\-glz\-wan\-compression=[auto|never|always]\fP
Configure wan image compression (lossy for slow links). Default
is auto.
.TP
.B \fBstreaming\-video=[off|all|filter]\fP
Configure video stream detection. Default is off.
.TP
.B \fBagent\-mouse=[on|off]\fP
Enable/disable passing mouse events via vdagent. Default is on.
.TP
.B \fBplayback\-compression=[on|off]\fP
Enable/disable audio stream compression (using celt 0.5.1).
Default is on.
.TP
.B \fBseamless\-migration=[on|off]\fP
Enable/disable spice seamless migration. Default is off.
.TP
.B \fBgl=[on|off]\fP
Enable/disable OpenGL context. Default is off.
.TP
.B \fBrendernode=<file>\fP
DRM render node for OpenGL rendering. If not specified, it will
pick the first available. (Since 2.9)
.UNINDENT
.TP
.B \fB\-portrait\fP
Rotate graphical output 90 deg left (only PXA LCD).
.TP
.B \fB\-rotate deg\fP
Rotate graphical output some deg left (only PXA LCD).
.TP
.B \fB\-vga type\fP
Select type of VGA card to emulate. Valid values for type are
.INDENT 7.0
.TP
.B \fBcirrus\fP
Cirrus Logic GD5446 Video card. All Windows versions starting
from Windows 95 should recognize and use this graphic card. For
optimal performances, use 16 bit color depth in the guest and
the host OS. (This card was the default before QEMU 2.2)
.TP
.B \fBstd\fP
Standard VGA card with Bochs VBE extensions. If your guest OS
supports the VESA 2.0 VBE extensions (e.g. Windows XP) and if
you want to use high resolution modes (>= 1280x1024x16) then you
should use this option. (This card is the default since QEMU
2.2)
.TP
.B \fBvmware\fP
VMWare SVGA\-II compatible adapter. Use it if you have
sufficiently recent XFree86/XOrg server or Windows guest with a
driver for this card.
.TP
.B \fBqxl\fP
QXL paravirtual graphic card. It is VGA compatible (including
VESA 2.0 VBE support). Works best with qxl guest drivers
installed though. Recommended choice when using the spice
protocol.
.TP
.B \fBtcx\fP
(sun4m only) Sun TCX framebuffer. This is the default
framebuffer for sun4m machines and offers both 8\-bit and 24\-bit
colour depths at a fixed resolution of 1024x768.
.TP
.B \fBcg3\fP
(sun4m only) Sun cgthree framebuffer. This is a simple 8\-bit
framebuffer for sun4m machines available in both 1024x768
(OpenBIOS) and 1152x900 (OBP) resolutions aimed at people
wishing to run older Solaris versions.
.TP
.B \fBvirtio\fP
Virtio VGA card.
.TP
.B \fBnone\fP
Disable VGA card.
.UNINDENT
.TP
.B \fB\-full\-screen\fP
Start in full screen.
.TP
.B \fB\-g\fP \fIwidth\fP\fBx\fP\fIheight\fP\fB[x\fP\fIdepth\fP\fB]\fP
Set the initial graphical resolution and depth (PPC, SPARC only).
.sp
For PPC the default is 800x600x32.
.sp
For SPARC with the TCX graphics device, the default is 1024x768x8
with the option of 1024x768x24. For cgthree, the default is
1024x768x8 with the option of 1152x900x8 for people who wish to use
OBP.
.TP
.B \fB\-vnc display[,option[,option[,...]]]\fP
Normally, if QEMU is compiled with graphical window support, it
displays output such as guest graphics, guest console, and the QEMU
monitor in a window. With this option, you can have QEMU listen on
VNC display display and redirect the VGA display over the VNC
session. It is very useful to enable the usb tablet device when
using this option (option \fB\-device usb\-tablet\fP). When using the
VNC display, you must use the \fB\-k\fP parameter to set the keyboard
layout if you are not using en\-us. Valid syntax for the display is
.INDENT 7.0
.TP
.B \fBto=L\fP
With this option, QEMU will try next available VNC displays,
until the number L, if the origianlly defined "\-vnc display" is
not available, e.g. port 5900+display is already used by another
application. By default, to=0.
.TP
.B \fBhost:d\fP
TCP connections will only be allowed from host on display d. By
convention the TCP port is 5900+d. Optionally, host can be
omitted in which case the server will accept connections from
any host.
.TP
.B \fBunix:path\fP
Connections will be allowed over UNIX domain sockets where path
is the location of a unix socket to listen for connections on.
.TP
.B \fBnone\fP
VNC is initialized but not started. The monitor \fBchange\fP
command can be used to later start the VNC server.
.UNINDENT
.sp
Following the display value there may be one or more option flags
separated by commas. Valid options are
.INDENT 7.0
.TP
.B \fBreverse=on|off\fP
Connect to a listening VNC client via a "reverse" connection.
The client is specified by the display. For reverse network
connections (host:d,\(ga\(gareverse\(ga\(ga), the d argument is a TCP port
number, not a display number.
.TP
.B \fBwebsocket=on|off\fP
Opens an additional TCP listening port dedicated to VNC
Websocket connections. If a bare websocket option is given, the
Websocket port is 5700+display. An alternative port can be
specified with the syntax \fBwebsocket\fP=port.
.sp
If host is specified connections will only be allowed from this
host. It is possible to control the websocket listen address
independently, using the syntax \fBwebsocket\fP=host:port.
.sp
If no TLS credentials are provided, the websocket connection
runs in unencrypted mode. If TLS credentials are provided, the
websocket connection requires encrypted client connections.
.TP
.B \fBpassword=on|off\fP
Require that password based authentication is used for client
connections.
.sp
The password must be set separately using the \fBset_password\fP
command in the \fI\%QEMU Monitor\fP\&. The
syntax to change your password is:
\fBset_password <protocol> <password>\fP where <protocol> could be
either "vnc" or "spice".
.sp
If you would like to change <protocol> password expiration, you
should use \fBexpire_password <protocol> <expiration\-time>\fP
where expiration time could be one of the following options:
now, never, +seconds or UNIX time of expiration, e.g. +60 to
make password expire in 60 seconds, or 1335196800 to make
password expire on "Mon Apr 23 12:00:00 EDT 2012" (UNIX time for
this date and time).
.sp
You can also use keywords "now" or "never" for the expiration
time to allow <protocol> password to expire immediately or never
expire.
.TP
.B \fBpassword\-secret=<secret\-id>\fP
Require that password based authentication is used for client
connections, using the password provided by the \fBsecret\fP
object identified by \fBsecret\-id\fP\&.
.TP
.B \fBtls\-creds=ID\fP
Provides the ID of a set of TLS credentials to use to secure the
VNC server. They will apply to both the normal VNC server socket
and the websocket socket (if enabled). Setting TLS credentials
will cause the VNC server socket to enable the VeNCrypt auth
mechanism. The credentials should have been previously created
using the \fB\-object tls\-creds\fP argument.
.TP
.B \fBtls\-authz=ID\fP
Provides the ID of the QAuthZ authorization object against which
the client\(aqs x509 distinguished name will validated. This object
is only resolved at time of use, so can be deleted and recreated
on the fly while the VNC server is active. If missing, it will
default to denying access.
.TP
.B \fBsasl=on|off\fP
Require that the client use SASL to authenticate with the VNC
server. The exact choice of authentication method used is
controlled from the system / user\(aqs SASL configuration file for
the \(aqqemu\(aq service. This is typically found in
/etc/sasl2/qemu.conf. If running QEMU as an unprivileged user,
an environment variable SASL_CONF_PATH can be used to make it
search alternate locations for the service config. While some
SASL auth methods can also provide data encryption (eg GSSAPI),
it is recommended that SASL always be combined with the \(aqtls\(aq
and \(aqx509\(aq settings to enable use of SSL and server
certificates. This ensures a data encryption preventing
compromise of authentication credentials. See the
\fI\%VNC security\fP section in the System Emulation Users Guide
for details on using SASL authentication.
.TP
.B \fBsasl\-authz=ID\fP
Provides the ID of the QAuthZ authorization object against which
the client\(aqs SASL username will validated. This object is only
resolved at time of use, so can be deleted and recreated on the
fly while the VNC server is active. If missing, it will default
to denying access.
.TP
.B \fBacl=on|off\fP
Legacy method for enabling authorization of clients against the
x509 distinguished name and SASL username. It results in the
creation of two \fBauthz\-list\fP objects with IDs of
\fBvnc.username\fP and \fBvnc.x509dname\fP\&. The rules for these
objects must be configured with the HMP ACL commands.
.sp
This option is deprecated and should no longer be used. The new
\fBsasl\-authz\fP and \fBtls\-authz\fP options are a replacement.
.TP
.B \fBlossy=on|off\fP
Enable lossy compression methods (gradient, JPEG, ...). If this
option is set, VNC client may receive lossy framebuffer updates
depending on its encoding settings. Enabling this option can
save a lot of bandwidth at the expense of quality.
.TP
.B \fBnon\-adaptive=on|off\fP
Disable adaptive encodings. Adaptive encodings are enabled by
default. An adaptive encoding will try to detect frequently
updated screen regions, and send updates in these regions using
a lossy encoding (like JPEG). This can be really helpful to save
bandwidth when playing videos. Disabling adaptive encodings
restores the original static behavior of encodings like Tight.
.TP
.B \fBshare=[allow\-exclusive|force\-shared|ignore]\fP
Set display sharing policy. \(aqallow\-exclusive\(aq allows clients to
ask for exclusive access. As suggested by the rfb spec this is
implemented by dropping other connections. Connecting multiple
clients in parallel requires all clients asking for a shared
session (vncviewer: \-shared switch). This is the default.
\(aqforce\-shared\(aq disables exclusive client access. Useful for
shared desktop sessions, where you don\(aqt want someone forgetting
specify \-shared disconnect everybody else. \(aqignore\(aq completely
ignores the shared flag and allows everybody connect
unconditionally. Doesn\(aqt conform to the rfb spec but is
traditional QEMU behavior.
.TP
.B \fBkey\-delay\-ms\fP
Set keyboard delay, for key down and key up events, in
milliseconds. Default is 10. Keyboards are low\-bandwidth
devices, so this slowdown can help the device and guest to keep
up and not lose events in case events are arriving in bulk.
Possible causes for the latter are flaky network connections, or
scripts for automated testing.
.TP
.B \fBaudiodev=audiodev\fP
Use the specified audiodev when the VNC client requests audio
transmission. When not using an \-audiodev argument, this option
must be omitted, otherwise is must be present and specify a
valid audiodev.
.TP
.B \fBpower\-control=on|off\fP
Permit the remote client to issue shutdown, reboot or reset power
control requests.
.UNINDENT
.UNINDENT
.SS i386 target only
.INDENT 0.0
.TP
.B \fB\-win2k\-hack\fP
Use it when installing Windows 2000 to avoid a disk full bug. After
Windows 2000 is installed, you no longer need this option (this
option slows down the IDE transfers).
.TP
.B \fB\-no\-fd\-bootchk\fP
Disable boot signature checking for floppy disks in BIOS. May be
needed to boot from old floppy disks.
.TP
.B \fB\-no\-acpi\fP
Disable ACPI (Advanced Configuration and Power Interface) support.
Use it if your guest OS complains about ACPI problems (PC target
machine only).
.TP
.B \fB\-no\-hpet\fP
Disable HPET support.
.TP
.B \fB\-acpitable [sig=str][,rev=n][,oem_id=str][,oem_table_id=str][,oem_rev=n] [,asl_compiler_id=str][,asl_compiler_rev=n][,data=file1[:file2]...]\fP
Add ACPI table with specified header fields and context from
specified files. For file=, take whole ACPI table from the specified
files, including all ACPI headers (possible overridden by other
options). For data=, only data portion of the table is used, all
header information is specified in the command line. If a SLIC table
is supplied to QEMU, then the SLIC\(aqs oem_id and oem_table_id
fields will override the same in the RSDT and the FADT (a.k.a.
FACP), in order to ensure the field matches required by the
Microsoft SLIC spec and the ACPI spec.
.TP
.B \fB\-smbios file=binary\fP
Load SMBIOS entry from binary file.
.TP
.B \fB\-smbios type=0[,vendor=str][,version=str][,date=str][,release=%d.%d][,uefi=on|off]\fP
Specify SMBIOS type 0 fields
.TP
.B \fB\-smbios type=1[,manufacturer=str][,product=str][,version=str][,serial=str][,uuid=uuid][,sku=str][,family=str]\fP
Specify SMBIOS type 1 fields
.TP
.B \fB\-smbios type=2[,manufacturer=str][,product=str][,version=str][,serial=str][,asset=str][,location=str]\fP
Specify SMBIOS type 2 fields
.TP
.B \fB\-smbios type=3[,manufacturer=str][,version=str][,serial=str][,asset=str][,sku=str]\fP
Specify SMBIOS type 3 fields
.TP
.B \fB\-smbios type=4[,sock_pfx=str][,manufacturer=str][,version=str][,serial=str][,asset=str][,part=str][,processor\-id=%d]\fP
Specify SMBIOS type 4 fields
.TP
.B \fB\-smbios type=11[,value=str][,path=filename]\fP
Specify SMBIOS type 11 fields
.sp
This argument can be repeated multiple times, and values are added in the order they are parsed.
Applications intending to use OEM strings data are encouraged to use their application name as
a prefix for the value string. This facilitates passing information for multiple applications
concurrently.
.sp
The \fBvalue=str\fP syntax provides the string data inline, while the \fBpath=filename\fP syntax
loads data from a file on disk. Note that the file is not permitted to contain any NUL bytes.
.sp
Both the \fBvalue\fP and \fBpath\fP options can be repeated multiple times and will be added to
the SMBIOS table in the order in which they appear.
.sp
Note that on the x86 architecture, the total size of all SMBIOS tables is limited to 65535
bytes. Thus the OEM strings data is not suitable for passing large amounts of data into the
guest. Instead it should be used as a indicator to inform the guest where to locate the real
data set, for example, by specifying the serial ID of a block device.
.sp
An example passing three strings is
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-smbios type=11,value=cloud\-init:ds=nocloud\-net;s=http://10.10.0.1:8000/,\e
                value=anaconda:method=http://dl.fedoraproject.org/pub/fedora/linux/releases/25/x86_64/os,\e
                path=/some/file/with/oemstringsdata.txt
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
In the guest OS this is visible with the \fBdmidecode\fP command
.INDENT 7.0
.INDENT 3.5
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ dmidecode \-t 11
Handle 0x0E00, DMI type 11, 5 bytes
OEM Strings
     String 1: cloud\-init:ds=nocloud\-net;s=http://10.10.0.1:8000/
     String 2: anaconda:method=http://dl.fedoraproject.org/pub/fedora/linux/releases/25/x86_64/os
     String 3: myapp:some extra data
.ft P
.fi
.UNINDENT
.UNINDENT
.UNINDENT
.UNINDENT
.TP
.B \fB\-smbios type=17[,loc_pfx=str][,bank=str][,manufacturer=str][,serial=str][,asset=str][,part=str][,speed=%d]\fP
Specify SMBIOS type 17 fields
.TP
.B \fB\-smbios type=41[,designation=str][,kind=str][,instance=%d][,pcidev=str]\fP
Specify SMBIOS type 41 fields
.sp
This argument can be repeated multiple times.  Its main use is to allow network interfaces be created
as \fBenoX\fP on Linux, with X being the instance number, instead of the name depending on the interface
position on the PCI bus.
.sp
Here is an example of use:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-netdev user,id=internet \e
\-device virtio\-net\-pci,mac=50:54:00:00:00:42,netdev=internet,id=internet\-dev \e
\-smbios type=41,designation=\(aqOnboard LAN\(aq,instance=1,kind=ethernet,pcidev=internet\-dev
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
In the guest OS, the device should then appear as \fBeno1\fP:
.sp
\&..parsed\-literal:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
$ ip \-brief l
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
eno1             UP             50:54:00:00:00:42 <BROADCAST,MULTICAST,UP,LOWER_UP>
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Currently, the PCI device has to be attached to the root bus.
.UNINDENT
.SS Network options
.INDENT 0.0
.TP
.B \fB\-nic [tap|bridge|user|l2tpv3|vde|netmap|vhost\-user|socket][,...][,mac=macaddr][,model=mn]\fP
This option is a shortcut for configuring both the on\-board
(default) guest NIC hardware and the host network backend in one go.
The host backend options are the same as with the corresponding
\fB\-netdev\fP options below. The guest NIC model can be set with
\fBmodel=modelname\fP\&. Use \fBmodel=help\fP to list the available device
types. The hardware MAC address can be set with \fBmac=macaddr\fP\&.
.sp
The following two example do exactly the same, to show how \fB\-nic\fP
can be used to shorten the command line length:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-netdev user,id=n1,ipv6=off \-device e1000,netdev=n1,mac=52:54:98:76:54:32
qemu\-system\-x86_64 \-nic user,ipv6=off,model=e1000,mac=52:54:98:76:54:32
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-nic none\fP
Indicate that no network devices should be configured. It is used to
override the default configuration (default NIC with "user" host
network backend) which is activated if no other networking options
are provided.
.TP
.B \fB\-netdev user,id=id[,option][,option][,...]\fP
Configure user mode host network backend which requires no
administrator privilege to run. Valid options are:
.INDENT 7.0
.TP
.B \fBid=id\fP
Assign symbolic name for use in monitor commands.
.TP
.B \fBipv4=on|off and ipv6=on|off\fP
Specify that either IPv4 or IPv6 must be enabled. If neither is
specified both protocols are enabled.
.TP
.B \fBnet=addr[/mask]\fP
Set IP network address the guest will see. Optionally specify
the netmask, either in the form a.b.c.d or as number of valid
top\-most bits. Default is 10.0.2.0/24.
.TP
.B \fBhost=addr\fP
Specify the guest\-visible address of the host. Default is the
2nd IP in the guest network, i.e. x.x.x.2.
.TP
.B \fBipv6\-net=addr[/int]\fP
Set IPv6 network address the guest will see (default is
fec0::/64). The network prefix is given in the usual hexadecimal
IPv6 address notation. The prefix size is optional, and is given
as the number of valid top\-most bits (default is 64).
.TP
.B \fBipv6\-host=addr\fP
Specify the guest\-visible IPv6 address of the host. Default is
the 2nd IPv6 in the guest network, i.e. xxxx::2.
.TP
.B \fBrestrict=on|off\fP
If this option is enabled, the guest will be isolated, i.e. it
will not be able to contact the host and no guest IP packets
will be routed over the host to the outside. This option does
not affect any explicitly set forwarding rules.
.TP
.B \fBhostname=name\fP
Specifies the client hostname reported by the built\-in DHCP
server.
.TP
.B \fBdhcpstart=addr\fP
Specify the first of the 16 IPs the built\-in DHCP server can
assign. Default is the 15th to 31st IP in the guest network,
i.e. x.x.x.15 to x.x.x.31.
.TP
.B \fBdns=addr\fP
Specify the guest\-visible address of the virtual nameserver. The
address must be different from the host address. Default is the
3rd IP in the guest network, i.e. x.x.x.3.
.TP
.B \fBipv6\-dns=addr\fP
Specify the guest\-visible address of the IPv6 virtual
nameserver. The address must be different from the host address.
Default is the 3rd IP in the guest network, i.e. xxxx::3.
.TP
.B \fBdnssearch=domain\fP
Provides an entry for the domain\-search list sent by the
built\-in DHCP server. More than one domain suffix can be
transmitted by specifying this option multiple times. If
supported, this will cause the guest to automatically try to
append the given domain suffix(es) in case a domain name can not
be resolved.
.sp
Example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-nic user,dnssearch=mgmt.example.org,dnssearch=example.org
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBdomainname=domain\fP
Specifies the client domain name reported by the built\-in DHCP
server.
.TP
.B \fBtftp=dir\fP
When using the user mode network stack, activate a built\-in TFTP
server. The files in dir will be exposed as the root of a TFTP
server. The TFTP client on the guest must be configured in
binary mode (use the command \fBbin\fP of the Unix TFTP client).
.TP
.B \fBtftp\-server\-name=name\fP
In BOOTP reply, broadcast name as the "TFTP server name"
(RFC2132 option 66). This can be used to advise the guest to
load boot files or configurations from a different server than
the host address.
.TP
.B \fBbootfile=file\fP
When using the user mode network stack, broadcast file as the
BOOTP filename. In conjunction with \fBtftp\fP, this can be used
to network boot a guest from a local directory.
.sp
Example (using pxelinux):
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-hda linux.img \-boot n \-device e1000,netdev=n1 \e
    \-netdev user,id=n1,tftp=/path/to/tftp/files,bootfile=/pxelinux.0
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBsmb=dir[,smbserver=addr]\fP
When using the user mode network stack, activate a built\-in SMB
server so that Windows OSes can access to the host files in
\fBdir\fP transparently. The IP address of the SMB server can be
set to addr. By default the 4th IP in the guest network is used,
i.e. x.x.x.4.
.sp
In the guest Windows OS, the line:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
10.0.2.4 smbserver
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
must be added in the file \fBC:\eWINDOWS\eLMHOSTS\fP (for windows
9x/Me) or \fBC:\eWINNT\eSYSTEM32\eDRIVERS\eETC\eLMHOSTS\fP (Windows
NT/2000).
.sp
Then \fBdir\fP can be accessed in \fB\e\esmbserver\eqemu\fP\&.
.sp
Note that a SAMBA server must be installed on the host OS.
.TP
.B \fBhostfwd=[tcp|udp]:[hostaddr]:hostport\-[guestaddr]:guestport\fP
Redirect incoming TCP or UDP connections to the host port
hostport to the guest IP address guestaddr on guest port
guestport. If guestaddr is not specified, its value is x.x.x.15
(default first address given by the built\-in DHCP server). By
specifying hostaddr, the rule can be bound to a specific host
interface. If no connection type is set, TCP is used. This
option can be given multiple times.
.sp
For example, to redirect host X11 connection from screen 1 to
guest screen 0, use the following:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# on the host
qemu\-system\-x86_64 \-nic user,hostfwd=tcp:127.0.0.1:6001\-:6000
# this host xterm should open in the guest X11 server
xterm \-display :1
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
To redirect telnet connections from host port 5555 to telnet
port on the guest, use the following:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# on the host
qemu\-system\-x86_64 \-nic user,hostfwd=tcp::5555\-:23
telnet localhost 5555
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Then when you use on the host \fBtelnet localhost 5555\fP, you
connect to the guest telnet server.
.TP
.B \fBguestfwd=[tcp]:server:port\-dev\fP; \fBguestfwd=[tcp]:server:port\-cmd:command\fP
Forward guest TCP connections to the IP address server on port
port to the character device dev or to a program executed by
cmd:command which gets spawned for each connection. This option
can be given multiple times.
.sp
You can either use a chardev directly and have that one used
throughout QEMU\(aqs lifetime, like in the following example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# open 10.10.1.1:4321 on bootup, connect 10.0.2.100:1234 to it whenever
# the guest accesses it
qemu\-system\-x86_64 \-nic user,guestfwd=tcp:10.0.2.100:1234\-\fI\%tcp:10.10.1.1:4321\fP
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Or you can execute a command on every TCP connection established
by the guest, so that QEMU behaves similar to an inetd process
for that virtual server:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# call "netcat 10.10.1.1 4321" on every TCP connection to 10.0.2.100:1234
# and connect the TCP stream to its stdin/stdout
qemu\-system\-x86_64 \-nic  \(aquser,id=n1,guestfwd=tcp:10.0.2.100:1234\-cmd:netcat 10.10.1.1 4321\(aq
.ft P
.fi
.UNINDENT
.UNINDENT
.UNINDENT
.TP
.B \fB\-netdev tap,id=id[,fd=h][,ifname=name][,script=file][,downscript=dfile][,br=bridge][,helper=helper]\fP
Configure a host TAP network backend with ID id.
.sp
Use the network script file to configure it and the network script
dfile to deconfigure it. If name is not provided, the OS
automatically provides one. The default network configure script is
\fB/etc/qemu\-ifup\fP and the default network deconfigure script is
\fB/etc/qemu\-ifdown\fP\&. Use \fBscript=no\fP or \fBdownscript=no\fP to
disable script execution.
.sp
If running QEMU as an unprivileged user, use the network helper
to configure the TAP interface and attach it to the bridge.
The default network helper executable is
\fB/path/to/qemu\-bridge\-helper\fP and the default bridge device is
\fBbr0\fP\&.
.sp
\fBfd\fP=h can be used to specify the handle of an already opened
host TAP interface.
.sp
Examples:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
#launch a QEMU instance with the default network script
qemu\-system\-x86_64 linux.img \-nic tap
.ft P
.fi
.UNINDENT
.UNINDENT
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
#launch a QEMU instance with two NICs, each one connected
#to a TAP device
qemu\-system\-x86_64 linux.img \e
        \-netdev tap,id=nd0,ifname=tap0 \-device e1000,netdev=nd0 \e
        \-netdev tap,id=nd1,ifname=tap1 \-device rtl8139,netdev=nd1
.ft P
.fi
.UNINDENT
.UNINDENT
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
#launch a QEMU instance with the default network helper to
#connect a TAP device to bridge br0
qemu\-system\-x86_64 linux.img \-device virtio\-net\-pci,netdev=n1 \e
        \-netdev tap,id=n1,"helper=/path/to/qemu\-bridge\-helper"
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-netdev bridge,id=id[,br=bridge][,helper=helper]\fP
Connect a host TAP network interface to a host bridge device.
.sp
Use the network helper helper to configure the TAP interface and
attach it to the bridge. The default network helper executable is
\fB/path/to/qemu\-bridge\-helper\fP and the default bridge device is
\fBbr0\fP\&.
.sp
Examples:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
#launch a QEMU instance with the default network helper to
#connect a TAP device to bridge br0
qemu\-system\-x86_64 linux.img \-netdev bridge,id=n1 \-device virtio\-net,netdev=n1
.ft P
.fi
.UNINDENT
.UNINDENT
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
#launch a QEMU instance with the default network helper to
#connect a TAP device to bridge qemubr0
qemu\-system\-x86_64 linux.img \-netdev bridge,br=qemubr0,id=n1 \-device virtio\-net,netdev=n1
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-netdev socket,id=id[,fd=h][,listen=[host]:port][,connect=host:port]\fP
This host network backend can be used to connect the guest\(aqs network
to another QEMU virtual machine using a TCP socket connection. If
\fBlisten\fP is specified, QEMU waits for incoming connections on port
(host is optional). \fBconnect\fP is used to connect to another QEMU
instance using the \fBlisten\fP option. \fBfd\fP=h specifies an
already opened TCP socket.
.sp
Example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# launch a first QEMU instance
qemu\-system\-x86_64 linux.img \e
                 \-device e1000,netdev=n1,mac=52:54:00:12:34:56 \e
                 \-netdev socket,id=n1,listen=:1234
# connect the network of this instance to the network of the first instance
qemu\-system\-x86_64 linux.img \e
                 \-device e1000,netdev=n2,mac=52:54:00:12:34:57 \e
                 \-netdev socket,id=n2,connect=127.0.0.1:1234
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-netdev socket,id=id[,fd=h][,mcast=maddr:port[,localaddr=addr]]\fP
Configure a socket host network backend to share the guest\(aqs network
traffic with another QEMU virtual machines using a UDP multicast
socket, effectively making a bus for every QEMU with same multicast
address maddr and port. NOTES:
.INDENT 7.0
.IP 1. 3
Several QEMU can be running on different hosts and share same bus
(assuming correct multicast setup for these hosts).
.IP 2. 3
mcast support is compatible with User Mode Linux (argument
\fBethN=mcast\fP), see \fI\%http://user\-mode\-linux.sf.net\fP\&.
.IP 3. 3
Use \fBfd=h\fP to specify an already opened UDP multicast socket.
.UNINDENT
.sp
Example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# launch one QEMU instance
qemu\-system\-x86_64 linux.img \e
                 \-device e1000,netdev=n1,mac=52:54:00:12:34:56 \e
                 \-netdev socket,id=n1,mcast=230.0.0.1:1234
# launch another QEMU instance on same "bus"
qemu\-system\-x86_64 linux.img \e
                 \-device e1000,netdev=n2,mac=52:54:00:12:34:57 \e
                 \-netdev socket,id=n2,mcast=230.0.0.1:1234
# launch yet another QEMU instance on same "bus"
qemu\-system\-x86_64 linux.img \e
                 \-device e1000,netdev=n3,mac=52:54:00:12:34:58 \e
                 \-netdev socket,id=n3,mcast=230.0.0.1:1234
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example (User Mode Linux compat.):
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# launch QEMU instance (note mcast address selected is UML\(aqs default)
qemu\-system\-x86_64 linux.img \e
                 \-device e1000,netdev=n1,mac=52:54:00:12:34:56 \e
                 \-netdev socket,id=n1,mcast=239.192.168.1:1102
# launch UML
/path/to/linux ubd0=/path/to/root_fs eth0=mcast
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example (send packets from host\(aqs 1.2.3.4):
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 linux.img \e
                 \-device e1000,netdev=n1,mac=52:54:00:12:34:56 \e
                 \-netdev socket,id=n1,mcast=239.192.168.1:1102,localaddr=1.2.3.4
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-netdev l2tpv3,id=id,src=srcaddr,dst=dstaddr[,srcport=srcport][,dstport=dstport],txsession=txsession[,rxsession=rxsession][,ipv6=on|off][,udp=on|off][,cookie64][,counter][,pincounter][,txcookie=txcookie][,rxcookie=rxcookie][,offset=offset]\fP
Configure a L2TPv3 pseudowire host network backend. L2TPv3 (RFC3931)
is a popular protocol to transport Ethernet (and other Layer 2) data
frames between two systems. It is present in routers, firewalls and
the Linux kernel (from version 3.3 onwards).
.sp
This transport allows a VM to communicate to another VM, router or
firewall directly.
.INDENT 7.0
.TP
.B \fBsrc=srcaddr\fP
source address (mandatory)
.TP
.B \fBdst=dstaddr\fP
destination address (mandatory)
.TP
.B \fBudp\fP
select udp encapsulation (default is ip).
.TP
.B \fBsrcport=srcport\fP
source udp port.
.TP
.B \fBdstport=dstport\fP
destination udp port.
.TP
.B \fBipv6\fP
force v6, otherwise defaults to v4.
.TP
.B \fBrxcookie=rxcookie\fP; \fBtxcookie=txcookie\fP
Cookies are a weak form of security in the l2tpv3 specification.
Their function is mostly to prevent misconfiguration. By default
they are 32 bit.
.TP
.B \fBcookie64\fP
Set cookie size to 64 bit instead of the default 32
.TP
.B \fBcounter=off\fP
Force a \(aqcut\-down\(aq L2TPv3 with no counter as in
draft\-mkonstan\-l2tpext\-keyed\-ipv6\-tunnel\-00
.TP
.B \fBpincounter=on\fP
Work around broken counter handling in peer. This may also help
on networks which have packet reorder.
.TP
.B \fBoffset=offset\fP
Add an extra offset between header and data
.UNINDENT
.sp
For example, to attach a VM running on host 4.3.2.1 via L2TPv3 to
the bridge br\-lan on the remote Linux host 1.2.3.4:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# Setup tunnel on linux host using raw ip as encapsulation
# on 1.2.3.4
ip l2tp add tunnel remote 4.3.2.1 local 1.2.3.4 tunnel_id 1 peer_tunnel_id 1 \e
    encap udp udp_sport 16384 udp_dport 16384
ip l2tp add session tunnel_id 1 name vmtunnel0 session_id \e
    0xFFFFFFFF peer_session_id 0xFFFFFFFF
ifconfig vmtunnel0 mtu 1500
ifconfig vmtunnel0 up
brctl addif br\-lan vmtunnel0


# on 4.3.2.1
# launch QEMU instance \- if your network has reorder or is very lossy add ,pincounter

qemu\-system\-x86_64 linux.img \-device e1000,netdev=n1 \e
    \-netdev l2tpv3,id=n1,src=4.2.3.1,dst=1.2.3.4,udp,srcport=16384,dstport=16384,rxsession=0xffffffff,txsession=0xffffffff,counter
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-netdev vde,id=id[,sock=socketpath][,port=n][,group=groupname][,mode=octalmode]\fP
Configure VDE backend to connect to PORT n of a vde switch running
on host and listening for incoming connections on socketpath. Use
GROUP groupname and MODE octalmode to change default ownership and
permissions for communication port. This option is only available if
QEMU has been compiled with vde support enabled.
.sp
Example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# launch vde switch
vde_switch \-F \-sock /tmp/myswitch
# launch QEMU instance
qemu\-system\-x86_64 linux.img \-nic vde,sock=/tmp/myswitch
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-netdev vhost\-user,chardev=id[,vhostforce=on|off][,queues=n]\fP
Establish a vhost\-user netdev, backed by a chardev id. The chardev
should be a unix domain socket backed one. The vhost\-user uses a
specifically defined protocol to pass vhost ioctl replacement
messages to an application on the other end of the socket. On
non\-MSIX guests, the feature can be forced with vhostforce. Use
\(aqqueues=n\(aq to specify the number of queues to be created for
multiqueue vhost\-user.
.sp
Example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu \-m 512 \-object memory\-backend\-file,id=mem,size=512M,mem\-path=/hugetlbfs,share=on \e
     \-numa node,memdev=mem \e
     \-chardev socket,id=chr0,path=/path/to/socket \e
     \-netdev type=vhost\-user,id=net0,chardev=chr0 \e
     \-device virtio\-net\-pci,netdev=net0
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-netdev vhost\-vdpa[,vhostdev=/path/to/dev][,vhostfd=h]\fP
Establish a vhost\-vdpa netdev.
.sp
vDPA device is a device that uses a datapath which complies with
the virtio specifications with a vendor specific control path.
vDPA devices can be both physically located on the hardware or
emulated by software.
.TP
.B \fB\-netdev hubport,id=id,hubid=hubid[,netdev=nd]\fP
Create a hub port on the emulated hub with ID hubid.
.sp
The hubport netdev lets you connect a NIC to a QEMU emulated hub
instead of a single netdev. Alternatively, you can also connect the
hubport to another netdev with ID nd by using the \fBnetdev=nd\fP
option.
.TP
.B \fB\-net nic[,netdev=nd][,macaddr=mac][,model=type] [,name=name][,addr=addr][,vectors=v]\fP
Legacy option to configure or create an on\-board (or machine
default) Network Interface Card(NIC) and connect it either to the
emulated hub with ID 0 (i.e. the default hub), or to the netdev nd.
If model is omitted, then the default NIC model associated with the
machine type is used. Note that the default NIC model may change in
future QEMU releases, so it is highly recommended to always specify
a model. Optionally, the MAC address can be changed to mac, the
device address set to addr (PCI cards only), and a name can be
assigned for use in monitor commands. Optionally, for PCI cards, you
can specify the number v of MSI\-X vectors that the card should have;
this option currently only affects virtio cards; set v = 0 to
disable MSI\-X. If no \fB\-net\fP option is specified, a single NIC is
created. QEMU can emulate several different models of network card.
Use \fB\-net nic,model=help\fP for a list of available devices for your
target.
.TP
.B \fB\-net user|tap|bridge|socket|l2tpv3|vde[,...][,name=name]\fP
Configure a host network backend (with the options corresponding to
the same \fB\-netdev\fP option) and connect it to the emulated hub 0
(the default hub). Use name to specify the name of the hub port.
.UNINDENT
.SS Character device options
.sp
The general form of a character device option is:
.INDENT 0.0
.TP
.B \fB\-chardev backend,id=id[,mux=on|off][,options]\fP
Backend is one of: \fBnull\fP, \fBsocket\fP, \fBudp\fP, \fBmsmouse\fP,
\fBvc\fP, \fBringbuf\fP, \fBfile\fP, \fBpipe\fP, \fBconsole\fP, \fBserial\fP,
\fBpty\fP, \fBstdio\fP, \fBbraille\fP, \fBtty\fP, \fBparallel\fP, \fBparport\fP,
\fBspicevmc\fP, \fBspiceport\fP\&. The specific backend will determine the
applicable options.
.sp
Use \fB\-chardev help\fP to print all available chardev backend types.
.sp
All devices must have an id, which can be any string up to 127
characters long. It is used to uniquely identify this device in
other command line directives.
.sp
A character device may be used in multiplexing mode by multiple
front\-ends. Specify \fBmux=on\fP to enable this mode. A multiplexer is
a "1:N" device, and here the "1" end is your specified chardev
backend, and the "N" end is the various parts of QEMU that can talk
to a chardev. If you create a chardev with \fBid=myid\fP and
\fBmux=on\fP, QEMU will create a multiplexer with your specified ID,
and you can then configure multiple front ends to use that chardev
ID for their input/output. Up to four different front ends can be
connected to a single multiplexed chardev. (Without multiplexing
enabled, a chardev can only be used by a single front end.) For
instance you could use this to allow a single stdio chardev to be
used by two serial ports and the QEMU monitor:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-chardev stdio,mux=on,id=char0 \e
\-mon chardev=char0,mode=readline \e
\-serial chardev:char0 \e
\-serial chardev:char0
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
You can have more than one multiplexer in a system configuration;
for instance you could have a TCP port multiplexed between UART 0
and UART 1, and stdio multiplexed between the QEMU monitor and a
parallel port:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-chardev stdio,mux=on,id=char0 \e
\-mon chardev=char0,mode=readline \e
\-parallel chardev:char0 \e
\-chardev tcp,...,mux=on,id=char1 \e
\-serial chardev:char1 \e
\-serial chardev:char1
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
When you\(aqre using a multiplexed character device, some escape
sequences are interpreted in the input. See the chapter about
\fI\%Keys in the character backend multiplexer\fP in the
System Emulation Users Guide for more details.
.sp
Note that some other command line options may implicitly create
multiplexed character backends; for instance \fB\-serial mon:stdio\fP
creates a multiplexed stdio backend connected to the serial port and
the QEMU monitor, and \fB\-nographic\fP also multiplexes the console
and the monitor to stdio.
.sp
There is currently no support for multiplexing in the other
direction (where a single QEMU front end takes input and output from
multiple chardevs).
.sp
Every backend supports the \fBlogfile\fP option, which supplies the
path to a file to record all data transmitted via the backend. The
\fBlogappend\fP option controls whether the log file will be truncated
or appended to when opened.
.UNINDENT
.sp
The available backends are:
.INDENT 0.0
.TP
.B \fB\-chardev null,id=id\fP
A void device. This device will not emit any data, and will drop any
data it receives. The null backend does not take any options.
.TP
.B \fB\-chardev socket,id=id[,TCP options or unix options][,server=on|off][,wait=on|off][,telnet=on|off][,websocket=on|off][,reconnect=seconds][,tls\-creds=id][,tls\-authz=id]\fP
Create a two\-way stream socket, which can be either a TCP or a unix
socket. A unix socket will be created if \fBpath\fP is specified.
Behaviour is undefined if TCP options are specified for a unix
socket.
.sp
\fBserver=on|off\fP specifies that the socket shall be a listening socket.
.sp
\fBwait=on|off\fP specifies that QEMU should not block waiting for a client
to connect to a listening socket.
.sp
\fBtelnet=on|off\fP specifies that traffic on the socket should interpret
telnet escape sequences.
.sp
\fBwebsocket=on|off\fP specifies that the socket uses WebSocket protocol for
communication.
.sp
\fBreconnect\fP sets the timeout for reconnecting on non\-server
sockets when the remote end goes away. qemu will delay this many
seconds and then attempt to reconnect. Zero disables reconnecting,
and is the default.
.sp
\fBtls\-creds\fP requests enablement of the TLS protocol for
encryption, and specifies the id of the TLS credentials to use for
the handshake. The credentials must be previously created with the
\fB\-object tls\-creds\fP argument.
.sp
\fBtls\-auth\fP provides the ID of the QAuthZ authorization object
against which the client\(aqs x509 distinguished name will be
validated. This object is only resolved at time of use, so can be
deleted and recreated on the fly while the chardev server is active.
If missing, it will default to denying access.
.sp
TCP and unix socket options are given below:
.INDENT 7.0
.TP
.B \fBTCP options: port=port[,host=host][,to=to][,ipv4=on|off][,ipv6=on|off][,nodelay=on|off]\fP
\fBhost\fP for a listening socket specifies the local address to
be bound. For a connecting socket species the remote host to
connect to. \fBhost\fP is optional for listening sockets. If not
specified it defaults to \fB0.0.0.0\fP\&.
.sp
\fBport\fP for a listening socket specifies the local port to be
bound. For a connecting socket specifies the port on the remote
host to connect to. \fBport\fP can be given as either a port
number or a service name. \fBport\fP is required.
.sp
\fBto\fP is only relevant to listening sockets. If it is
specified, and \fBport\fP cannot be bound, QEMU will attempt to
bind to subsequent ports up to and including \fBto\fP until it
succeeds. \fBto\fP must be specified as a port number.
.sp
\fBipv4=on|off\fP and \fBipv6=on|off\fP specify that either IPv4
or IPv6 must be used. If neither is specified the socket may
use either protocol.
.sp
\fBnodelay=on|off\fP disables the Nagle algorithm.
.TP
.B \fBunix options: path=path[,abstract=on|off][,tight=on|off]\fP
\fBpath\fP specifies the local path of the unix socket. \fBpath\fP
is required.
\fBabstract=on|off\fP specifies the use of the abstract socket namespace,
rather than the filesystem.  Optional, defaults to false.
\fBtight=on|off\fP sets the socket length of abstract sockets to their minimum,
rather than the full sun_path length.  Optional, defaults to true.
.UNINDENT
.TP
.B \fB\-chardev udp,id=id[,host=host],port=port[,localaddr=localaddr][,localport=localport][,ipv4=on|off][,ipv6=on|off]\fP
Sends all traffic from the guest to a remote host over UDP.
.sp
\fBhost\fP specifies the remote host to connect to. If not specified
it defaults to \fBlocalhost\fP\&.
.sp
\fBport\fP specifies the port on the remote host to connect to.
\fBport\fP is required.
.sp
\fBlocaladdr\fP specifies the local address to bind to. If not
specified it defaults to \fB0.0.0.0\fP\&.
.sp
\fBlocalport\fP specifies the local port to bind to. If not specified
any available local port will be used.
.sp
\fBipv4=on|off\fP and \fBipv6=on|off\fP specify that either IPv4 or IPv6 must be used.
If neither is specified the device may use either protocol.
.TP
.B \fB\-chardev msmouse,id=id\fP
Forward QEMU\(aqs emulated msmouse events to the guest. \fBmsmouse\fP
does not take any options.
.TP
.B \fB\-chardev vc,id=id[[,width=width][,height=height]][[,cols=cols][,rows=rows]]\fP
Connect to a QEMU text console. \fBvc\fP may optionally be given a
specific size.
.sp
\fBwidth\fP and \fBheight\fP specify the width and height respectively
of the console, in pixels.
.sp
\fBcols\fP and \fBrows\fP specify that the console be sized to fit a
text console with the given dimensions.
.TP
.B \fB\-chardev ringbuf,id=id[,size=size]\fP
Create a ring buffer with fixed size \fBsize\fP\&. size must be a power
of two and defaults to \fB64K\fP\&.
.TP
.B \fB\-chardev file,id=id,path=path\fP
Log all traffic received from the guest to a file.
.sp
\fBpath\fP specifies the path of the file to be opened. This file will
be created if it does not already exist, and overwritten if it does.
\fBpath\fP is required.
.TP
.B \fB\-chardev pipe,id=id,path=path\fP
Create a two\-way connection to the guest. The behaviour differs
slightly between Windows hosts and other hosts:
.sp
On Windows, a single duplex pipe will be created at
\fB\e\e.pipe\epath\fP\&.
.sp
On other hosts, 2 pipes will be created called \fBpath.in\fP and
\fBpath.out\fP\&. Data written to \fBpath.in\fP will be received by the
guest. Data written by the guest can be read from \fBpath.out\fP\&. QEMU
will not create these fifos, and requires them to be present.
.sp
\fBpath\fP forms part of the pipe path as described above. \fBpath\fP is
required.
.TP
.B \fB\-chardev console,id=id\fP
Send traffic from the guest to QEMU\(aqs standard output. \fBconsole\fP
does not take any options.
.sp
\fBconsole\fP is only available on Windows hosts.
.TP
.B \fB\-chardev serial,id=id,path=path\fP
Send traffic from the guest to a serial device on the host.
.sp
On Unix hosts serial will actually accept any tty device, not only
serial lines.
.sp
\fBpath\fP specifies the name of the serial device to open.
.TP
.B \fB\-chardev pty,id=id\fP
Create a new pseudo\-terminal on the host and connect to it. \fBpty\fP
does not take any options.
.sp
\fBpty\fP is not available on Windows hosts.
.TP
.B \fB\-chardev stdio,id=id[,signal=on|off]\fP
Connect to standard input and standard output of the QEMU process.
.sp
\fBsignal\fP controls if signals are enabled on the terminal, that
includes exiting QEMU with the key sequence Control\-c. This option
is enabled by default, use \fBsignal=off\fP to disable it.
.TP
.B \fB\-chardev braille,id=id\fP
Connect to a local BrlAPI server. \fBbraille\fP does not take any
options.
.TP
.B \fB\-chardev tty,id=id,path=path\fP
\fBtty\fP is only available on Linux, Sun, FreeBSD, NetBSD, OpenBSD
and DragonFlyBSD hosts. It is an alias for \fBserial\fP\&.
.sp
\fBpath\fP specifies the path to the tty. \fBpath\fP is required.
.TP
.B \fB\-chardev parallel,id=id,path=path\fP

.TP
.B \fB\-chardev parport,id=id,path=path\fP
\fBparallel\fP is only available on Linux, FreeBSD and DragonFlyBSD
hosts.
.sp
Connect to a local parallel port.
.sp
\fBpath\fP specifies the path to the parallel port device. \fBpath\fP is
required.
.TP
.B \fB\-chardev spicevmc,id=id,debug=debug,name=name\fP
\fBspicevmc\fP is only available when spice support is built in.
.sp
\fBdebug\fP debug level for spicevmc
.sp
\fBname\fP name of spice channel to connect to
.sp
Connect to a spice virtual machine channel, such as vdiport.
.TP
.B \fB\-chardev spiceport,id=id,debug=debug,name=name\fP
\fBspiceport\fP is only available when spice support is built in.
.sp
\fBdebug\fP debug level for spicevmc
.sp
\fBname\fP name of spice port to connect to
.sp
Connect to a spice port, allowing a Spice client to handle the
traffic identified by a name (preferably a fqdn).
.UNINDENT
.SS TPM device options
.sp
The general form of a TPM device option is:
.INDENT 0.0
.TP
.B \fB\-tpmdev backend,id=id[,options]\fP
The specific backend type will determine the applicable options. The
\fB\-tpmdev\fP option creates the TPM backend and requires a
\fB\-device\fP option that specifies the TPM frontend interface model.
.sp
Use \fB\-tpmdev help\fP to print all available TPM backend types.
.UNINDENT
.sp
The available backends are:
.INDENT 0.0
.TP
.B \fB\-tpmdev passthrough,id=id,path=path,cancel\-path=cancel\-path\fP
(Linux\-host only) Enable access to the host\(aqs TPM using the
passthrough driver.
.sp
\fBpath\fP specifies the path to the host\(aqs TPM device, i.e., on a
Linux host this would be \fB/dev/tpm0\fP\&. \fBpath\fP is optional and by
default \fB/dev/tpm0\fP is used.
.sp
\fBcancel\-path\fP specifies the path to the host TPM device\(aqs sysfs
entry allowing for cancellation of an ongoing TPM command.
\fBcancel\-path\fP is optional and by default QEMU will search for the
sysfs entry to use.
.sp
Some notes about using the host\(aqs TPM with the passthrough driver:
.sp
The TPM device accessed by the passthrough driver must not be used
by any other application on the host.
.sp
Since the host\(aqs firmware (BIOS/UEFI) has already initialized the
TPM, the VM\(aqs firmware (BIOS/UEFI) will not be able to initialize
the TPM again and may therefore not show a TPM\-specific menu that
would otherwise allow the user to configure the TPM, e.g., allow the
user to enable/disable or activate/deactivate the TPM. Further, if
TPM ownership is released from within a VM then the host\(aqs TPM will
get disabled and deactivated. To enable and activate the TPM again
afterwards, the host has to be rebooted and the user is required to
enter the firmware\(aqs menu to enable and activate the TPM. If the TPM
is left disabled and/or deactivated most TPM commands will fail.
.sp
To create a passthrough TPM use the following two options:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-tpmdev passthrough,id=tpm0 \-device tpm\-tis,tpmdev=tpm0
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Note that the \fB\-tpmdev\fP id is \fBtpm0\fP and is referenced by
\fBtpmdev=tpm0\fP in the device option.
.TP
.B \fB\-tpmdev emulator,id=id,chardev=dev\fP
(Linux\-host only) Enable access to a TPM emulator using Unix domain
socket based chardev backend.
.sp
\fBchardev\fP specifies the unique ID of a character device backend
that provides connection to the software TPM server.
.sp
To create a TPM emulator backend device with chardev socket backend:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-chardev socket,id=chrtpm,path=/tmp/swtpm\-sock \-tpmdev emulator,id=tpm0,chardev=chrtpm \-device tpm\-tis,tpmdev=tpm0
.ft P
.fi
.UNINDENT
.UNINDENT
.UNINDENT
.SS Boot Image or Kernel specific
.sp
There are broadly 4 ways you can boot a system with QEMU.
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
specify a firmware and let it control finding a kernel
.IP \(bu 2
specify a firmware and pass a hint to the kernel to boot
.IP \(bu 2
direct kernel image boot
.IP \(bu 2
manually load files into the guest\(aqs address space
.UNINDENT
.UNINDENT
.UNINDENT
.sp
The third method is useful for quickly testing kernels but as there is
no firmware to pass configuration information to the kernel the
hardware must either be probeable, the kernel built for the exact
configuration or passed some configuration data (e.g. a DTB blob)
which tells the kernel what drivers it needs. This exact details are
often hardware specific.
.sp
The final method is the most generic way of loading images into the
guest address space and used mostly for \fBbare metal\fP type
development where the reset vectors of the processor are taken into
account.
.sp
For x86 machines and some other architectures \fB\-bios\fP will generally
do the right thing with whatever it is given. For other machines the
more strict \fB\-pflash\fP option needs an image that is sized for the
flash device for the given machine type.
.sp
Please see the \fI\%QEMU System Emulator Targets\fP section of the manual for
more detailed documentation.
.INDENT 0.0
.TP
.B \fB\-bios file\fP
Set the filename for the BIOS.
.TP
.B \fB\-pflash file\fP
Use file as a parallel flash image.
.UNINDENT
.sp
The kernel options were designed to work with Linux kernels although
other things (like hypervisors) can be packaged up as a kernel
executable image. The exact format of a executable image is usually
architecture specific.
.sp
The way in which the kernel is started (what address it is loaded at,
what if any information is passed to it via CPU registers, the state
of the hardware when it is started, and so on) is also architecture
specific. Typically it follows the specification laid down by the
Linux kernel for how kernels for that architecture must be started.
.INDENT 0.0
.TP
.B \fB\-kernel bzImage\fP
Use bzImage as kernel image. The kernel can be either a Linux kernel
or in multiboot format.
.TP
.B \fB\-append cmdline\fP
Use cmdline as kernel command line
.TP
.B \fB\-initrd file\fP
Use file as initial ram disk.
.TP
.B \fB\-initrd "file1 arg=foo,file2"\fP
This syntax is only available with multiboot.
.sp
Use file1 and file2 as modules and pass arg=foo as parameter to the
first module.
.TP
.B \fB\-dtb file\fP
Use file as a device tree binary (dtb) image and pass it to the
kernel on boot.
.UNINDENT
.sp
Finally you can also manually load images directly into the address
space of the guest. This is most useful for developers who already
know the layout of their guest and take care to ensure something sane
will happen when the reset vector executes.
.sp
The generic loader can be invoked by using the loader device:
.sp
\fB\-device loader,addr=<addr>,data=<data>,data\-len=<data\-len>[,data\-be=<data\-be>][,cpu\-num=<cpu\-num>]\fP
.sp
there is also the guest loader which operates in a similar way but
tweaks the DTB so a hypervisor loaded via \fB\-kernel\fP can find where
the guest image is:
.sp
\fB\-device guest\-loader,addr=<addr>[,kernel=<path>,[bootargs=<arguments>]][,initrd=<path>]\fP
.SS Debug/Expert options
.INDENT 0.0
.TP
.B \fB\-compat [deprecated\-input=@var{input\-policy}][,deprecated\-output=@var{output\-policy}]\fP
Set policy for handling deprecated management interfaces (experimental):
.INDENT 7.0
.TP
.B \fBdeprecated\-input=accept\fP (default)
Accept deprecated commands and arguments
.TP
.B \fBdeprecated\-input=reject\fP
Reject deprecated commands and arguments
.TP
.B \fBdeprecated\-input=crash\fP
Crash on deprecated commands and arguments
.TP
.B \fBdeprecated\-output=accept\fP (default)
Emit deprecated command results and events
.TP
.B \fBdeprecated\-output=hide\fP
Suppress deprecated command results and events
.UNINDENT
.sp
Limitation: covers only syntactic aspects of QMP.
.TP
.B \fB\-compat [unstable\-input=@var{input\-policy}][,unstable\-output=@var{output\-policy}]\fP
Set policy for handling unstable management interfaces (experimental):
.INDENT 7.0
.TP
.B \fBunstable\-input=accept\fP (default)
Accept unstable commands and arguments
.TP
.B \fBunstable\-input=reject\fP
Reject unstable commands and arguments
.TP
.B \fBunstable\-input=crash\fP
Crash on unstable commands and arguments
.TP
.B \fBunstable\-output=accept\fP (default)
Emit unstable command results and events
.TP
.B \fBunstable\-output=hide\fP
Suppress unstable command results and events
.UNINDENT
.sp
Limitation: covers only syntactic aspects of QMP.
.TP
.B \fB\-fw_cfg [name=]name,file=file\fP
Add named fw_cfg entry with contents from file file.
.TP
.B \fB\-fw_cfg [name=]name,string=str\fP
Add named fw_cfg entry with contents from string str.
.sp
The terminating NUL character of the contents of str will not be
included as part of the fw_cfg item data. To insert contents with
embedded NUL characters, you have to use the file parameter.
.sp
The fw_cfg entries are passed by QEMU through to the guest.
.sp
Example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-fw_cfg name=opt/com.mycompany/blob,file=./my_blob.bin
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
creates an fw_cfg entry named opt/com.mycompany/blob with contents
from ./my_blob.bin.
.TP
.B \fB\-serial dev\fP
Redirect the virtual serial port to host character device dev. The
default device is \fBvc\fP in graphical mode and \fBstdio\fP in non
graphical mode.
.sp
This option can be used several times to simulate up to 4 serial
ports.
.sp
Use \fB\-serial none\fP to disable all serial ports.
.sp
Available character devices are:
.INDENT 7.0
.TP
.B \fBvc[:WxH]\fP
Virtual console. Optionally, a width and height can be given in
pixel with
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
vc:800x600
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
It is also possible to specify width or height in characters:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
vc:80Cx24C
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBpty\fP
[Linux only] Pseudo TTY (a new PTY is automatically allocated)
.TP
.B \fBnone\fP
No device is allocated.
.TP
.B \fBnull\fP
void device
.TP
.B \fBchardev:id\fP
Use a named character device defined with the \fB\-chardev\fP
option.
.TP
.B \fB/dev/XXX\fP
[Linux only] Use host tty, e.g. \fB/dev/ttyS0\fP\&. The host serial
port parameters are set according to the emulated ones.
.TP
.B \fB/dev/parportN\fP
[Linux only, parallel port only] Use host parallel port N.
Currently SPP and EPP parallel port features can be used.
.TP
.B \fBfile:filename\fP
Write output to filename. No character can be read.
.TP
.B \fBstdio\fP
[Unix only] standard input/output
.TP
.B \fBpipe:filename\fP
name pipe filename
.TP
.B \fBCOMn\fP
[Windows only] Use host serial port n
.TP
.B \fBudp:[remote_host]:remote_port[@[src_ip]:src_port]\fP
This implements UDP Net Console. When remote_host or src_ip
are not specified they default to \fB0.0.0.0\fP\&. When not using a
specified src_port a random port is automatically chosen.
.sp
If you just want a simple readonly console you can use
\fBnetcat\fP or \fBnc\fP, by starting QEMU with:
\fB\-serial udp::4555\fP and nc as: \fBnc \-u \-l \-p 4555\fP\&. Any time
QEMU writes something to that port it will appear in the
netconsole session.
.sp
If you plan to send characters back via netconsole or you want
to stop and start QEMU a lot of times, you should have QEMU use
the same source port each time by using something like \fB\-serial
udp::4555@:4556\fP to QEMU. Another approach is to use a patched
version of netcat which can listen to a TCP port and send and
receive characters via udp. If you have a patched version of
netcat which activates telnet remote echo and single char
transfer, then you can use the following options to set up a
netcat redirector to allow telnet on port 5555 to access the
QEMU port.
.INDENT 7.0
.TP
.B \fBQEMU Options:\fP
\-serial udp::4555@:4556
.TP
.B \fBnetcat options:\fP
\-u \-P 4555 \-L 0.0.0.0:4556 \-t \-p 5555 \-I \-T
.TP
.B \fBtelnet options:\fP
localhost 5555
.UNINDENT
.TP
.B \fBtcp:[host]:port[,server=on|off][,wait=on|off][,nodelay=on|off][,reconnect=seconds]\fP
The TCP Net Console has two modes of operation. It can send the
serial I/O to a location or wait for a connection from a
location. By default the TCP Net Console is sent to host at the
port. If you use the \fBserver=on\fP option QEMU will wait for a client
socket application to connect to the port before continuing,
unless the \fBwait=on|off\fP option was specified. The \fBnodelay=on|off\fP
option disables the Nagle buffering algorithm. The \fBreconnect=on\fP
option only applies if \fBserver=no\fP is set, if the connection goes
down it will attempt to reconnect at the given interval. If host
is omitted, 0.0.0.0 is assumed. Only one TCP connection at a
time is accepted. You can use \fBtelnet=on\fP to connect to the
corresponding character device.
.INDENT 7.0
.TP
.B \fBExample to send tcp console to 192.168.0.2 port 4444\fP
\-serial \fI\%tcp:192.168.0.2:4444\fP
.TP
.B \fBExample to listen and wait on port 4444 for connection\fP
\-serial \fI\%tcp::4444,server=on\fP
.TP
.B \fBExample to not wait and listen on ip 192.168.0.100 port 4444\fP
\-serial \fI\%tcp:192.168.0.100:4444,server=on,wait=off\fP
.UNINDENT
.TP
.B \fBtelnet:host:port[,server=on|off][,wait=on|off][,nodelay=on|off]\fP
The telnet protocol is used instead of raw tcp sockets. The
options work the same as if you had specified \fB\-serial tcp\fP\&.
The difference is that the port acts like a telnet server or
client using telnet option negotiation. This will also allow you
to send the MAGIC_SYSRQ sequence if you use a telnet that
supports sending the break sequence. Typically in unix telnet
you do it with Control\-] and then type "send break" followed by
pressing the enter key.
.TP
.B \fBwebsocket:host:port,server=on[,wait=on|off][,nodelay=on|off]\fP
The WebSocket protocol is used instead of raw tcp socket. The
port acts as a WebSocket server. Client mode is not supported.
.TP
.B \fBunix:path[,server=on|off][,wait=on|off][,reconnect=seconds]\fP
A unix domain socket is used instead of a tcp socket. The option
works the same as if you had specified \fB\-serial tcp\fP except
the unix domain socket path is used for connections.
.TP
.B \fBmon:dev_string\fP
This is a special option to allow the monitor to be multiplexed
onto another serial port. The monitor is accessed with key
sequence of Control\-a and then pressing c. dev_string should be
any one of the serial devices specified above. An example to
multiplex the monitor onto a telnet server listening on port
4444 would be:
.sp
\fB\-serial mon:telnet::4444,server=on,wait=off\fP
.sp
When the monitor is multiplexed to stdio in this way, Ctrl+C
will not terminate QEMU any more but will be passed to the guest
instead.
.TP
.B \fBbraille\fP
Braille device. This will use BrlAPI to display the braille
output on a real or fake device.
.TP
.B \fBmsmouse\fP
Three button serial mouse. Configure the guest to use Microsoft
protocol.
.UNINDENT
.TP
.B \fB\-parallel dev\fP
Redirect the virtual parallel port to host device dev (same devices
as the serial port). On Linux hosts, \fB/dev/parportN\fP can be used
to use hardware devices connected on the corresponding host parallel
port.
.sp
This option can be used several times to simulate up to 3 parallel
ports.
.sp
Use \fB\-parallel none\fP to disable all parallel ports.
.TP
.B \fB\-monitor dev\fP
Redirect the monitor to host device dev (same devices as the serial
port). The default device is \fBvc\fP in graphical mode and \fBstdio\fP
in non graphical mode. Use \fB\-monitor none\fP to disable the default
monitor.
.TP
.B \fB\-qmp dev\fP
Like \-monitor but opens in \(aqcontrol\(aq mode.
.TP
.B \fB\-qmp\-pretty dev\fP
Like \-qmp but uses pretty JSON formatting.
.TP
.B \fB\-mon [chardev=]name[,mode=readline|control][,pretty[=on|off]]\fP
Setup monitor on chardev name. \fBmode=control\fP configures
a QMP monitor (a JSON RPC\-style protocol) and it is not the
same as HMP, the human monitor that has a "(qemu)" prompt.
\fBpretty\fP is only valid when \fBmode=control\fP,
turning on JSON pretty printing to ease
human reading and debugging.
.TP
.B \fB\-debugcon dev\fP
Redirect the debug console to host device dev (same devices as the
serial port). The debug console is an I/O port which is typically
port 0xe9; writing to that I/O port sends output to this device. The
default device is \fBvc\fP in graphical mode and \fBstdio\fP in non
graphical mode.
.TP
.B \fB\-pidfile file\fP
Store the QEMU process PID in file. It is useful if you launch QEMU
from a script.
.TP
.B \fB\-singlestep\fP
Run the emulation in single step mode.
.TP
.B \fB\-\-preconfig\fP
Pause QEMU for interactive configuration before the machine is
created, which allows querying and configuring properties that will
affect machine initialization. Use QMP command \(aqx\-exit\-preconfig\(aq to
exit the preconfig state and move to the next state (i.e. run guest
if \-S isn\(aqt used or pause the second time if \-S is used). This
option is experimental.
.TP
.B \fB\-S\fP
Do not start CPU at startup (you must type \(aqc\(aq in the monitor).
.TP
.B \fB\-overcommit mem\-lock=on|off\fP

.TP
.B \fB\-overcommit cpu\-pm=on|off\fP
Run qemu with hints about host resource overcommit. The default is
to assume that host overcommits all resources.
.sp
Locking qemu and guest memory can be enabled via \fBmem\-lock=on\fP
(disabled by default). This works when host memory is not
overcommitted and reduces the worst\-case latency for guest.
.sp
Guest ability to manage power state of host cpus (increasing latency
for other processes on the same host cpu, but decreasing latency for
guest) can be enabled via \fBcpu\-pm=on\fP (disabled by default). This
works best when host CPU is not overcommitted. When used, host
estimates of CPU cycle and power utilization will be incorrect, not
taking into account guest idle time.
.TP
.B \fB\-gdb dev\fP
Accept a gdb connection on device dev (see the \fI\%GDB usage\fP chapter
in the System Emulation Users Guide). Note that this option does not pause QEMU
execution \-\- if you want QEMU to not start the guest until you
connect with gdb and issue a \fBcontinue\fP command, you will need to
also pass the \fB\-S\fP option to QEMU.
.sp
The most usual configuration is to listen on a local TCP socket:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-gdb tcp::3117
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
but you can specify other backends; UDP, pseudo TTY, or even stdio
are all reasonable use cases. For example, a stdio connection
allows you to start QEMU from within gdb and establish the
connection via a pipe:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
(gdb) target remote | exec qemu\-system\-x86_64 \-gdb stdio ...
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-s\fP
Shorthand for \-gdb \fI\%tcp::1234\fP, i.e. open a gdbserver on TCP port 1234
(see the \fI\%GDB usage\fP chapter in the System Emulation Users Guide).
.TP
.B \fB\-d item1[,...]\fP
Enable logging of specified items. Use \(aq\-d help\(aq for a list of log
items.
.TP
.B \fB\-D logfile\fP
Output log in logfile instead of to stderr
.TP
.B \fB\-dfilter range1[,...]\fP
Filter debug output to that relevant to a range of target addresses.
The filter spec can be either start+size, start\-size or start..end
where start end and size are the addresses and sizes required. For
example:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
\-dfilter 0x8000..0x8fff,0xffffffc000080000+0x200,0xffffffc000060000\-0x1000
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Will dump output for any code in the 0x1000 sized block starting at
0x8000 and the 0x200 sized block starting at 0xffffffc000080000 and
another 0x1000 sized block starting at 0xffffffc00005f000.
.TP
.B \fB\-seed number\fP
Force the guest to use a deterministic pseudo\-random number
generator, seeded with number. This does not affect crypto routines
within the host.
.TP
.B \fB\-L  path\fP
Set the directory for the BIOS, VGA BIOS and keymaps.
.sp
To list all the data directories, use \fB\-L help\fP\&.
.TP
.B \fB\-enable\-kvm\fP
Enable KVM full virtualization support. This option is only
available if KVM support is enabled when compiling.
.TP
.B \fB\-xen\-domid id\fP
Specify xen guest domain id (XEN only).
.TP
.B \fB\-xen\-attach\fP
Attach to existing xen domain. libxl will use this when starting
QEMU (XEN only). Restrict set of available xen operations to
specified domain id (XEN only).
.TP
.B \fB\-no\-reboot\fP
Exit instead of rebooting.
.TP
.B \fB\-no\-shutdown\fP
Don\(aqt exit QEMU on guest shutdown, but instead only stop the
emulation. This allows for instance switching to monitor to commit
changes to the disk image.
.TP
.B \fB\-action event=action\fP
The action parameter serves to modify QEMU\(aqs default behavior when
certain guest events occur. It provides a generic method for specifying the
same behaviors that are modified by the \fB\-no\-reboot\fP and \fB\-no\-shutdown\fP
parameters.
.sp
Examples:
.sp
\fB\-action panic=none\fP
\fB\-action reboot=shutdown,shutdown=pause\fP
\fB\-device i6300esb \-action watchdog=pause\fP
.TP
.B \fB\-loadvm file\fP
Start right away with a saved state (\fBloadvm\fP in monitor)
.TP
.B \fB\-daemonize\fP
Daemonize the QEMU process after initialization. QEMU will not
detach from standard IO until it is ready to receive connections on
any of its devices. This option is a useful way for external
programs to launch QEMU without having to cope with initialization
race conditions.
.TP
.B \fB\-option\-rom file\fP
Load the contents of file as an option ROM. This option is useful to
load things like EtherBoot.
.TP
.B \fB\-rtc [base=utc|localtime|datetime][,clock=host|rt|vm][,driftfix=none|slew]\fP
Specify \fBbase\fP as \fButc\fP or \fBlocaltime\fP to let the RTC start at
the current UTC or local time, respectively. \fBlocaltime\fP is
required for correct date in MS\-DOS or Windows. To start at a
specific point in time, provide datetime in the format
\fB2006\-06\-17T16:01:21\fP or \fB2006\-06\-17\fP\&. The default base is UTC.
.sp
By default the RTC is driven by the host system time. This allows
using of the RTC as accurate reference clock inside the guest,
specifically if the host time is smoothly following an accurate
external reference clock, e.g. via NTP. If you want to isolate the
guest time from the host, you can set \fBclock\fP to \fBrt\fP instead,
which provides a host monotonic clock if host support it. To even
prevent the RTC from progressing during suspension, you can set
\fBclock\fP to \fBvm\fP (virtual clock). \(aq\fBclock=vm\fP\(aq is
recommended especially in icount mode in order to preserve
determinism; however, note that in icount mode the speed of the
virtual clock is variable and can in general differ from the host
clock.
.sp
Enable \fBdriftfix\fP (i386 targets only) if you experience time drift
problems, specifically with Windows\(aq ACPI HAL. This option will try
to figure out how many timer interrupts were not processed by the
Windows guest and will re\-inject them.
.TP
.B \fB\-icount [shift=N|auto][,align=on|off][,sleep=on|off][,rr=record|replay,rrfile=filename[,rrsnapshot=snapshot]]\fP
Enable virtual instruction counter. The virtual cpu will execute one
instruction every 2^N ns of virtual time. If \fBauto\fP is specified
then the virtual cpu speed will be automatically adjusted to keep
virtual time within a few seconds of real time.
.sp
Note that while this option can give deterministic behavior, it does
not provide cycle accurate emulation. Modern CPUs contain
superscalar out of order cores with complex cache hierarchies. The
number of instructions executed often has little or no correlation
with actual performance.
.sp
When the virtual cpu is sleeping, the virtual time will advance at
default speed unless \fBsleep=on\fP is specified. With
\fBsleep=on\fP, the virtual time will jump to the next timer
deadline instantly whenever the virtual cpu goes to sleep mode and
will not advance if no timer is enabled. This behavior gives
deterministic execution times from the guest point of view.
The default if icount is enabled is \fBsleep=off\fP\&.
\fBsleep=on\fP cannot be used together with either \fBshift=auto\fP
or \fBalign=on\fP\&.
.sp
\fBalign=on\fP will activate the delay algorithm which will try to
synchronise the host clock and the virtual clock. The goal is to
have a guest running at the real frequency imposed by the shift
option. Whenever the guest clock is behind the host clock and if
\fBalign=on\fP is specified then we print a message to the user to
inform about the delay. Currently this option does not work when
\fBshift\fP is \fBauto\fP\&. Note: The sync algorithm will work for those
shift values for which the guest clock runs ahead of the host clock.
Typically this happens when the shift value is high (how high
depends on the host machine). The default if icount is enabled
is \fBalign=off\fP\&.
.sp
When the \fBrr\fP option is specified deterministic record/replay is
enabled. The \fBrrfile=\fP option must also be provided to
specify the path to the replay log. In record mode data is written
to this file, and in replay mode it is read back.
If the \fBrrsnapshot\fP option is given then it specifies a VM snapshot
name. In record mode, a new VM snapshot with the given name is created
at the start of execution recording. In replay mode this option
specifies the snapshot name used to load the initial VM state.
.TP
.B \fB\-watchdog\-action action\fP
The action controls what QEMU will do when the watchdog timer
expires. The default is \fBreset\fP (forcefully reset the guest).
Other possible actions are: \fBshutdown\fP (attempt to gracefully
shutdown the guest), \fBpoweroff\fP (forcefully poweroff the guest),
\fBinject\-nmi\fP (inject a NMI into the guest), \fBpause\fP (pause the
guest), \fBdebug\fP (print a debug message and continue), or \fBnone\fP
(do nothing).
.sp
Note that the \fBshutdown\fP action requires that the guest responds
to ACPI signals, which it may not be able to do in the sort of
situations where the watchdog would have expired, and thus
\fB\-watchdog\-action shutdown\fP is not recommended for production use.
.sp
Examples:
.sp
\fB\-device i6300esb \-watchdog\-action pause\fP
.TP
.B \fB\-echr numeric_ascii_value\fP
Change the escape character used for switching to the monitor when
using monitor and serial sharing. The default is \fB0x01\fP when using
the \fB\-nographic\fP option. \fB0x01\fP is equal to pressing
\fBControl\-a\fP\&. You can select a different character from the ascii
control keys where 1 through 26 map to Control\-a through Control\-z.
For instance you could use the either of the following to change the
escape character to Control\-t.
.sp
\fB\-echr 0x14\fP; \fB\-echr 20\fP
.TP
.B \fB\-incoming tcp:[host]:port[,to=maxport][,ipv4=on|off][,ipv6=on|off]\fP

.TP
.B \fB\-incoming rdma:host:port[,ipv4=on|off][,ipv6=on|off]\fP
Prepare for incoming migration, listen on a given tcp port.
.TP
.B \fB\-incoming unix:socketpath\fP
Prepare for incoming migration, listen on a given unix socket.
.TP
.B \fB\-incoming fd:fd\fP
Accept incoming migration from a given filedescriptor.
.TP
.B \fB\-incoming exec:cmdline\fP
Accept incoming migration as an output from specified external
command.
.TP
.B \fB\-incoming defer\fP
Wait for the URI to be specified via migrate_incoming. The monitor
can be used to change settings (such as migration parameters) prior
to issuing the migrate_incoming to allow the migration to begin.
.TP
.B \fB\-only\-migratable\fP
Only allow migratable devices. Devices will not be allowed to enter
an unmigratable state.
.TP
.B \fB\-nodefaults\fP
Don\(aqt create default devices. Normally, QEMU sets the default
devices like serial port, parallel port, virtual console, monitor
device, VGA adapter, floppy and CD\-ROM drive and others. The
\fB\-nodefaults\fP option will disable all those default devices.
.TP
.B \fB\-chroot dir\fP
Immediately before starting guest execution, chroot to the specified
directory. Especially useful in combination with \-runas.
This option is not supported for Windows hosts.
.TP
.B \fB\-runas user\fP
Immediately before starting guest execution, drop root privileges,
switching to the specified user.
.TP
.B \fB\-prom\-env variable=value\fP
Set OpenBIOS nvram variable to given value (PPC, SPARC only).
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-sparc \-prom\-env \(aqauto\-boot?=false\(aq \e
 \-prom\-env \(aqboot\-device=sd(0,2,0):d\(aq \-prom\-env \(aqboot\-args=linux single\(aq
.ft P
.fi
.UNINDENT
.UNINDENT
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-ppc \-prom\-env \(aqauto\-boot?=false\(aq \e
 \-prom\-env \(aqboot\-device=hd:2,\eyaboot\(aq \e
 \-prom\-env \(aqboot\-args=conf=hd:2,\eyaboot.conf\(aq
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-semihosting\fP
Enable semihosting mode (ARM, M68K, Xtensa, MIPS, Nios II, RISC\-V only).
.sp
Note that this allows guest direct access to the host filesystem, so
should only be used with a trusted guest OS.
.sp
See the \-semihosting\-config option documentation for further
information about the facilities this enables.
.TP
.B \fB\-semihosting\-config [enable=on|off][,target=native|gdb|auto][,chardev=id][,userspace=on|off][,arg=str[,...]]\fP
Enable and configure semihosting (ARM, M68K, Xtensa, MIPS, Nios II, RISC\-V
only).
.sp
Note that this allows guest direct access to the host filesystem, so
should only be used with a trusted guest OS.
.sp
On Arm this implements the standard semihosting API, version 2.0.
.sp
On M68K this implements the "ColdFire GDB" interface used by
libgloss.
.sp
Xtensa semihosting provides basic file IO calls, such as
open/read/write/seek/select. Tensilica baremetal libc for ISS and
linux platform "sim" use this interface.
.sp
On RISC\-V this implements the standard semihosting API, version 0.2.
.INDENT 7.0
.TP
.B \fBtarget=native|gdb|auto\fP
Defines where the semihosting calls will be addressed, to QEMU
(\fBnative\fP) or to GDB (\fBgdb\fP). The default is \fBauto\fP, which
means \fBgdb\fP during debug sessions and \fBnative\fP otherwise.
.TP
.B \fBchardev=str1\fP
Send the output to a chardev backend output for native or auto
output when not in gdb
.TP
.B \fBuserspace=on|off\fP
Allows code running in guest userspace to access the semihosting
interface. The default is that only privileged guest code can
make semihosting calls. Note that setting \fBuserspace=on\fP should
only be used if all guest code is trusted (for example, in
bare\-metal test case code).
.TP
.B \fBarg=str1,arg=str2,...\fP
Allows the user to pass input arguments, and can be used
multiple times to build up a list. The old\-style
\fB\-kernel\fP/\fB\-append\fP method of passing a command line is
still supported for backward compatibility. If both the
\fB\-\-semihosting\-config arg\fP and the \fB\-kernel\fP/\fB\-append\fP are
specified, the former is passed to semihosting as it always
takes precedence.
.UNINDENT
.TP
.B \fB\-old\-param\fP
Old param mode (ARM only).
.TP
.B \fB\-sandbox arg[,obsolete=string][,elevateprivileges=string][,spawn=string][,resourcecontrol=string]\fP
Enable Seccomp mode 2 system call filter. \(aqon\(aq will enable syscall
filtering and \(aqoff\(aq will disable it. The default is \(aqoff\(aq.
.INDENT 7.0
.TP
.B \fBobsolete=string\fP
Enable Obsolete system calls
.TP
.B \fBelevateprivileges=string\fP
Disable set*uid|gid system calls
.TP
.B \fBspawn=string\fP
Disable *fork and execve
.TP
.B \fBresourcecontrol=string\fP
Disable process affinity and schedular priority
.UNINDENT
.TP
.B \fB\-readconfig file\fP
Read device configuration from file. This approach is useful when
you want to spawn QEMU process with many command line options but
you don\(aqt want to exceed the command line character limit.
.TP
.B \fB\-no\-user\-config\fP
The \fB\-no\-user\-config\fP option makes QEMU not load any of the
user\-provided config files on sysconfdir.
.TP
.B \fB\-trace\-unassigned\fP
Trace unassigned memory or i/o accesses to stderr.
.TP
.B \fB\-trace [[enable=]pattern][,events=file][,file=file]\fP
Specify tracing options.
.sp
\fB[enable=]PATTERN\fP
.INDENT 7.0
.INDENT 3.5
Immediately enable events matching \fIPATTERN\fP
(either event name or a globbing pattern).  This option is only
available if QEMU has been compiled with the \fBsimple\fP, \fBlog\fP
or \fBftrace\fP tracing backend.  To specify multiple events or patterns,
specify the \fB\-trace\fP option multiple times.
.sp
Use \fB\-trace help\fP to print a list of names of trace points.
.UNINDENT
.UNINDENT
.sp
\fBevents=FILE\fP
.INDENT 7.0
.INDENT 3.5
Immediately enable events listed in \fIFILE\fP\&.
The file must contain one event name (as listed in the \fBtrace\-events\-all\fP
file) per line; globbing patterns are accepted too.  This option is only
available if QEMU has been compiled with the \fBsimple\fP, \fBlog\fP or
\fBftrace\fP tracing backend.
.UNINDENT
.UNINDENT
.sp
\fBfile=FILE\fP
.INDENT 7.0
.INDENT 3.5
Log output traces to \fIFILE\fP\&.
This option is only available if QEMU has been compiled with
the \fBsimple\fP tracing backend.
.UNINDENT
.UNINDENT
.TP
.B \fB\-plugin file=file[,argname=argvalue]\fP
Load a plugin.
.INDENT 7.0
.TP
.B \fBfile=file\fP
Load the given plugin from a shared library file.
.TP
.B \fBargname=argvalue\fP
Argument passed to the plugin. (Can be given multiple times.)
.UNINDENT
.TP
.B \fB\-async\-teardown\fP
Enable asynchronous teardown. A new process called "cleanup/<QEMU_PID>"
will be created at startup sharing the address space with the main qemu
process, using clone. It will wait for the main qemu process to
terminate completely, and then exit.
This allows qemu to terminate very quickly even if the guest was
huge, leaving the teardown of the address space to the cleanup
process. Since the cleanup process shares the same cgroups as the
main qemu process, accounting is performed correctly. This only
works if the cleanup process is not forcefully killed with SIGKILL
before the main qemu process has terminated completely.
.TP
.B \fB\-msg [timestamp[=on|off]][,guest\-name[=on|off]]\fP
Control error message format.
.INDENT 7.0
.TP
.B \fBtimestamp=on|off\fP
Prefix messages with a timestamp. Default is off.
.TP
.B \fBguest\-name=on|off\fP
Prefix messages with guest name but only if \-name guest option is set
otherwise the option is ignored. Default is off.
.UNINDENT
.TP
.B \fB\-dump\-vmstate file\fP
Dump json\-encoded vmstate information for current machine type to
file in file
.TP
.B \fB\-enable\-sync\-profile\fP
Enable synchronization profiling.
.UNINDENT
.SS Generic object creation
.INDENT 0.0
.TP
.B \fB\-object typename[,prop1=value1,...]\fP
Create a new object of type typename setting properties in the order
they are specified. Note that the \(aqid\(aq property must be set. These
objects are placed in the \(aq/objects\(aq path.
.INDENT 7.0
.TP
.B \fB\-object memory\-backend\-file,id=id,size=size,mem\-path=dir,share=on|off,discard\-data=on|off,merge=on|off,dump=on|off,prealloc=on|off,host\-nodes=host\-nodes,policy=default|preferred|bind|interleave,align=align,readonly=on|off\fP
Creates a memory file backend object, which can be used to back
the guest RAM with huge pages.
.sp
The \fBid\fP parameter is a unique ID that will be used to
reference this memory region in other parameters, e.g. \fB\-numa\fP,
\fB\-device nvdimm\fP, etc.
.sp
The \fBsize\fP option provides the size of the memory region, and
accepts common suffixes, e.g. \fB500M\fP\&.
.sp
The \fBmem\-path\fP provides the path to either a shared memory or
huge page filesystem mount.
.sp
The \fBshare\fP boolean option determines whether the memory
region is marked as private to QEMU, or shared. The latter
allows a co\-operating external process to access the QEMU memory
region.
.sp
The \fBshare\fP is also required for pvrdma devices due to
limitations in the RDMA API provided by Linux.
.sp
Setting share=on might affect the ability to configure NUMA
bindings for the memory backend under some circumstances, see
Documentation/vm/numa_memory_policy.txt on the Linux kernel
source tree for additional details.
.sp
Setting the \fBdiscard\-data\fP boolean option to on indicates that
file contents can be destroyed when QEMU exits, to avoid
unnecessarily flushing data to the backing file. Note that
\fBdiscard\-data\fP is only an optimization, and QEMU might not
discard file contents if it aborts unexpectedly or is terminated
using SIGKILL.
.sp
The \fBmerge\fP boolean option enables memory merge, also known as
MADV_MERGEABLE, so that Kernel Samepage Merging will consider
the pages for memory deduplication.
.sp
Setting the \fBdump\fP boolean option to off excludes the memory
from core dumps. This feature is also known as MADV_DONTDUMP.
.sp
The \fBprealloc\fP boolean option enables memory preallocation.
.sp
The \fBhost\-nodes\fP option binds the memory range to a list of
NUMA host nodes.
.sp
The \fBpolicy\fP option sets the NUMA policy to one of the
following values:
.INDENT 7.0
.TP
.B \fBdefault\fP
default host policy
.TP
.B \fBpreferred\fP
prefer the given host node list for allocation
.TP
.B \fBbind\fP
restrict memory allocation to the given host node list
.TP
.B \fBinterleave\fP
interleave memory allocations across the given host node
list
.UNINDENT
.sp
The \fBalign\fP option specifies the base address alignment when
QEMU mmap(2) \fBmem\-path\fP, and accepts common suffixes, eg
\fB2M\fP\&. Some backend store specified by \fBmem\-path\fP requires an
alignment different than the default one used by QEMU, eg the
device DAX /dev/dax0.0 requires 2M alignment rather than 4K. In
such cases, users can specify the required alignment via this
option.
.sp
The \fBpmem\fP option specifies whether the backing file specified
by \fBmem\-path\fP is in host persistent memory that can be
accessed using the SNIA NVM programming model (e.g. Intel
NVDIMM). If \fBpmem\fP is set to \(aqon\(aq, QEMU will take necessary
operations to guarantee the persistence of its own writes to
\fBmem\-path\fP (e.g. in vNVDIMM label emulation and live
migration). Also, we will map the backend\-file with MAP_SYNC
flag, which ensures the file metadata is in sync for
\fBmem\-path\fP in case of host crash or a power failure. MAP_SYNC
requires support from both the host kernel (since Linux kernel
4.15) and the filesystem of \fBmem\-path\fP mounted with DAX
option.
.sp
The \fBreadonly\fP option specifies whether the backing file is opened
read\-only or read\-write (default).
.TP
.B \fB\-object memory\-backend\-ram,id=id,merge=on|off,dump=on|off,share=on|off,prealloc=on|off,size=size,host\-nodes=host\-nodes,policy=default|preferred|bind|interleave\fP
Creates a memory backend object, which can be used to back the
guest RAM. Memory backend objects offer more control than the
\fB\-m\fP option that is traditionally used to define guest RAM.
Please refer to \fBmemory\-backend\-file\fP for a description of the
options.
.TP
.B \fB\-object memory\-backend\-memfd,id=id,merge=on|off,dump=on|off,share=on|off,prealloc=on|off,size=size,host\-nodes=host\-nodes,policy=default|preferred|bind|interleave,seal=on|off,hugetlb=on|off,hugetlbsize=size\fP
Creates an anonymous memory file backend object, which allows
QEMU to share the memory with an external process (e.g. when
using vhost\-user). The memory is allocated with memfd and
optional sealing. (Linux only)
.sp
The \fBseal\fP option creates a sealed\-file, that will block
further resizing the memory (\(aqon\(aq by default).
.sp
The \fBhugetlb\fP option specify the file to be created resides in
the hugetlbfs filesystem (since Linux 4.14). Used in conjunction
with the \fBhugetlb\fP option, the \fBhugetlbsize\fP option specify
the hugetlb page size on systems that support multiple hugetlb
page sizes (it must be a power of 2 value supported by the
system).
.sp
In some versions of Linux, the \fBhugetlb\fP option is
incompatible with the \fBseal\fP option (requires at least Linux
4.16).
.sp
Please refer to \fBmemory\-backend\-file\fP for a description of the
other options.
.sp
The \fBshare\fP boolean option is on by default with memfd.
.TP
.B \fB\-object rng\-builtin,id=id\fP
Creates a random number generator backend which obtains entropy
from QEMU builtin functions. The \fBid\fP parameter is a unique ID
that will be used to reference this entropy backend from the
\fBvirtio\-rng\fP device. By default, the \fBvirtio\-rng\fP device
uses this RNG backend.
.TP
.B \fB\-object rng\-random,id=id,filename=/dev/random\fP
Creates a random number generator backend which obtains entropy
from a device on the host. The \fBid\fP parameter is a unique ID
that will be used to reference this entropy backend from the
\fBvirtio\-rng\fP device. The \fBfilename\fP parameter specifies
which file to obtain entropy from and if omitted defaults to
\fB/dev/urandom\fP\&.
.TP
.B \fB\-object rng\-egd,id=id,chardev=chardevid\fP
Creates a random number generator backend which obtains entropy
from an external daemon running on the host. The \fBid\fP
parameter is a unique ID that will be used to reference this
entropy backend from the \fBvirtio\-rng\fP device. The \fBchardev\fP
parameter is the unique ID of a character device backend that
provides the connection to the RNG daemon.
.TP
.B \fB\-object tls\-creds\-anon,id=id,endpoint=endpoint,dir=/path/to/cred/dir,verify\-peer=on|off\fP
Creates a TLS anonymous credentials object, which can be used to
provide TLS support on network backends. The \fBid\fP parameter is
a unique ID which network backends will use to access the
credentials. The \fBendpoint\fP is either \fBserver\fP or \fBclient\fP
depending on whether the QEMU network backend that uses the
credentials will be acting as a client or as a server. If
\fBverify\-peer\fP is enabled (the default) then once the handshake
is completed, the peer credentials will be verified, though this
is a no\-op for anonymous credentials.
.sp
The dir parameter tells QEMU where to find the credential files.
For server endpoints, this directory may contain a file
dh\-params.pem providing diffie\-hellman parameters to use for the
TLS server. If the file is missing, QEMU will generate a set of
DH parameters at startup. This is a computationally expensive
operation that consumes random pool entropy, so it is
recommended that a persistent set of parameters be generated
upfront and saved.
.TP
.B \fB\-object tls\-creds\-psk,id=id,endpoint=endpoint,dir=/path/to/keys/dir[,username=username]\fP
Creates a TLS Pre\-Shared Keys (PSK) credentials object, which
can be used to provide TLS support on network backends. The
\fBid\fP parameter is a unique ID which network backends will use
to access the credentials. The \fBendpoint\fP is either \fBserver\fP
or \fBclient\fP depending on whether the QEMU network backend that
uses the credentials will be acting as a client or as a server.
For clients only, \fBusername\fP is the username which will be
sent to the server. If omitted it defaults to "qemu".
.sp
The dir parameter tells QEMU where to find the keys file. It is
called "dir/keys.psk" and contains "username:key" pairs. This
file can most easily be created using the GnuTLS \fBpsktool\fP
program.
.sp
For server endpoints, dir may also contain a file dh\-params.pem
providing diffie\-hellman parameters to use for the TLS server.
If the file is missing, QEMU will generate a set of DH
parameters at startup. This is a computationally expensive
operation that consumes random pool entropy, so it is
recommended that a persistent set of parameters be generated up
front and saved.
.TP
.B \fB\-object tls\-creds\-x509,id=id,endpoint=endpoint,dir=/path/to/cred/dir,priority=priority,verify\-peer=on|off,passwordid=id\fP
Creates a TLS anonymous credentials object, which can be used to
provide TLS support on network backends. The \fBid\fP parameter is
a unique ID which network backends will use to access the
credentials. The \fBendpoint\fP is either \fBserver\fP or \fBclient\fP
depending on whether the QEMU network backend that uses the
credentials will be acting as a client or as a server. If
\fBverify\-peer\fP is enabled (the default) then once the handshake
is completed, the peer credentials will be verified. With x509
certificates, this implies that the clients must be provided
with valid client certificates too.
.sp
The dir parameter tells QEMU where to find the credential files.
For server endpoints, this directory may contain a file
dh\-params.pem providing diffie\-hellman parameters to use for the
TLS server. If the file is missing, QEMU will generate a set of
DH parameters at startup. This is a computationally expensive
operation that consumes random pool entropy, so it is
recommended that a persistent set of parameters be generated
upfront and saved.
.sp
For x509 certificate credentials the directory will contain
further files providing the x509 certificates. The certificates
must be stored in PEM format, in filenames ca\-cert.pem,
ca\-crl.pem (optional), server\-cert.pem (only servers),
server\-key.pem (only servers), client\-cert.pem (only clients),
and client\-key.pem (only clients).
.sp
For the server\-key.pem and client\-key.pem files which contain
sensitive private keys, it is possible to use an encrypted
version by providing the passwordid parameter. This provides the
ID of a previously created \fBsecret\fP object containing the
password for decryption.
.sp
The priority parameter allows to override the global default
priority used by gnutls. This can be useful if the system
administrator needs to use a weaker set of crypto priorities for
QEMU without potentially forcing the weakness onto all
applications. Or conversely if one wants wants a stronger
default for QEMU than for all other applications, they can do
this through this parameter. Its format is a gnutls priority
string as described at
\fI\%https://gnutls.org/manual/html_node/Priority\-Strings.html\fP\&.
.TP
.B \fB\-object tls\-cipher\-suites,id=id,priority=priority\fP
Creates a TLS cipher suites object, which can be used to control
the TLS cipher/protocol algorithms that applications are permitted
to use.
.sp
The \fBid\fP parameter is a unique ID which frontends will use to
access the ordered list of permitted TLS cipher suites from the
host.
.sp
The \fBpriority\fP parameter allows to override the global default
priority used by gnutls. This can be useful if the system
administrator needs to use a weaker set of crypto priorities for
QEMU without potentially forcing the weakness onto all
applications. Or conversely if one wants wants a stronger
default for QEMU than for all other applications, they can do
this through this parameter. Its format is a gnutls priority
string as described at
\fI\%https://gnutls.org/manual/html_node/Priority\-Strings.html\fP\&.
.sp
An example of use of this object is to control UEFI HTTPS Boot.
The tls\-cipher\-suites object exposes the ordered list of permitted
TLS cipher suites from the host side to the guest firmware, via
fw_cfg. The list is represented as an array of IANA_TLS_CIPHER
objects. The firmware uses the IANA_TLS_CIPHER array for configuring
guest\-side TLS.
.sp
In the following example, the priority at which the host\-side policy
is retrieved is given by the \fBpriority\fP property.
Given that QEMU uses GNUTLS, \fBpriority=@SYSTEM\fP may be used to
refer to /etc/crypto\-policies/back\-ends/gnutls.config.
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \e
    \-object tls\-cipher\-suites,id=mysuite0,priority=@SYSTEM \e
    \-fw_cfg name=etc/edk2/https/ciphers,gen_id=mysuite0
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-object filter\-buffer,id=id,netdev=netdevid,interval=t[,queue=all|rx|tx][,status=on|off][,position=head|tail|id=<id>][,insert=behind|before]\fP
Interval t can\(aqt be 0, this filter batches the packet delivery:
all packets arriving in a given interval on netdev netdevid are
delayed until the end of the interval. Interval is in
microseconds. \fBstatus\fP is optional that indicate whether the
netfilter is on (enabled) or off (disabled), the default status
for netfilter will be \(aqon\(aq.
.sp
queue all|rx|tx is an option that can be applied to any
netfilter.
.sp
\fBall\fP: the filter is attached both to the receive and the
transmit queue of the netdev (default).
.sp
\fBrx\fP: the filter is attached to the receive queue of the
netdev, where it will receive packets sent to the netdev.
.sp
\fBtx\fP: the filter is attached to the transmit queue of the
netdev, where it will receive packets sent by the netdev.
.sp
position head|tail|id=<id> is an option to specify where the
filter should be inserted in the filter list. It can be applied
to any netfilter.
.sp
\fBhead\fP: the filter is inserted at the head of the filter list,
before any existing filters.
.sp
\fBtail\fP: the filter is inserted at the tail of the filter list,
behind any existing filters (default).
.sp
\fBid=<id>\fP: the filter is inserted before or behind the filter
specified by <id>, see the insert option below.
.sp
insert behind|before is an option to specify where to insert
the new filter relative to the one specified with
position=id=<id>. It can be applied to any netfilter.
.sp
\fBbefore\fP: insert before the specified filter.
.sp
\fBbehind\fP: insert behind the specified filter (default).
.TP
.B \fB\-object filter\-mirror,id=id,netdev=netdevid,outdev=chardevid,queue=all|rx|tx[,vnet_hdr_support][,position=head|tail|id=<id>][,insert=behind|before]\fP
filter\-mirror on netdev netdevid,mirror net packet to
chardevchardevid, if it has the vnet_hdr_support flag,
filter\-mirror will mirror packet with vnet_hdr_len.
.TP
.B \fB\-object filter\-redirector,id=id,netdev=netdevid,indev=chardevid,outdev=chardevid,queue=all|rx|tx[,vnet_hdr_support][,position=head|tail|id=<id>][,insert=behind|before]\fP
filter\-redirector on netdev netdevid,redirect filter\(aqs net
packet to chardev chardevid,and redirect indev\(aqs packet to
filter.if it has the vnet_hdr_support flag, filter\-redirector
will redirect packet with vnet_hdr_len. Create a
filter\-redirector we need to differ outdev id from indev id, id
can not be the same. we can just use indev or outdev, but at
least one of indev or outdev need to be specified.
.TP
.B \fB\-object filter\-rewriter,id=id,netdev=netdevid,queue=all|rx|tx,[vnet_hdr_support][,position=head|tail|id=<id>][,insert=behind|before]\fP
Filter\-rewriter is a part of COLO project.It will rewrite tcp
packet to secondary from primary to keep secondary tcp
connection,and rewrite tcp packet to primary from secondary make
tcp packet can be handled by client.if it has the
vnet_hdr_support flag, we can parse packet with vnet header.
.sp
usage: colo secondary: \-object
filter\-redirector,id=f1,netdev=hn0,queue=tx,indev=red0 \-object
filter\-redirector,id=f2,netdev=hn0,queue=rx,outdev=red1 \-object
filter\-rewriter,id=rew0,netdev=hn0,queue=all
.TP
.B \fB\-object filter\-dump,id=id,netdev=dev[,file=filename][,maxlen=len][,position=head|tail|id=<id>][,insert=behind|before]\fP
Dump the network traffic on netdev dev to the file specified by
filename. At most len bytes (64k by default) per packet are
stored. The file format is libpcap, so it can be analyzed with
tools such as tcpdump or Wireshark.
.TP
.B \fB\-object colo\-compare,id=id,primary_in=chardevid,secondary_in=chardevid,outdev=chardevid,iothread=id[,vnet_hdr_support][,notify_dev=id][,compare_timeout=@var{ms}][,expired_scan_cycle=@var{ms}][,max_queue_size=@var{size}]\fP
Colo\-compare gets packet from primary_in chardevid and
secondary_in, then compare whether the payload of primary packet
and secondary packet are the same. If same, it will output
primary packet to out_dev, else it will notify COLO\-framework to do
checkpoint and send primary packet to out_dev. In order to
improve efficiency, we need to put the task of comparison in
another iothread. If it has the vnet_hdr_support flag,
colo compare will send/recv packet with vnet_hdr_len.
The \fI\%compare_timeout=@var{ms\fP} determines the maximum time of the
colo\-compare hold the packet. The \fI\%expired_scan_cycle=@var{ms\fP}
is to set the period of scanning expired primary node network packets.
The \fI\%max_queue_size=@var{size\fP} is to set the max compare queue
size depend on user environment.
If user want to use Xen COLO, need to add the notify_dev to
notify Xen colo\-frame to do checkpoint.
.sp
COLO\-compare must be used with the help of filter\-mirror,
filter\-redirector and filter\-rewriter.
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
KVM COLO

primary:
\-netdev tap,id=hn0,vhost=off,script=/etc/qemu\-ifup,downscript=/etc/qemu\-ifdown
\-device e1000,id=e0,netdev=hn0,mac=52:a4:00:12:78:66
\-chardev socket,id=mirror0,host=3.3.3.3,port=9003,server=on,wait=off
\-chardev socket,id=compare1,host=3.3.3.3,port=9004,server=on,wait=off
\-chardev socket,id=compare0,host=3.3.3.3,port=9001,server=on,wait=off
\-chardev socket,id=compare0\-0,host=3.3.3.3,port=9001
\-chardev socket,id=compare_out,host=3.3.3.3,port=9005,server=on,wait=off
\-chardev socket,id=compare_out0,host=3.3.3.3,port=9005
\-object iothread,id=iothread1
\-object filter\-mirror,id=m0,netdev=hn0,queue=tx,outdev=mirror0
\-object filter\-redirector,netdev=hn0,id=redire0,queue=rx,indev=compare_out
\-object filter\-redirector,netdev=hn0,id=redire1,queue=rx,outdev=compare0
\-object colo\-compare,id=comp0,primary_in=compare0\-0,secondary_in=compare1,outdev=compare_out0,iothread=iothread1

secondary:
\-netdev tap,id=hn0,vhost=off,script=/etc/qemu\-ifup,down script=/etc/qemu\-ifdown
\-device e1000,netdev=hn0,mac=52:a4:00:12:78:66
\-chardev socket,id=red0,host=3.3.3.3,port=9003
\-chardev socket,id=red1,host=3.3.3.3,port=9004
\-object filter\-redirector,id=f1,netdev=hn0,queue=tx,indev=red0
\-object filter\-redirector,id=f2,netdev=hn0,queue=rx,outdev=red1


Xen COLO

primary:
\-netdev tap,id=hn0,vhost=off,script=/etc/qemu\-ifup,downscript=/etc/qemu\-ifdown
\-device e1000,id=e0,netdev=hn0,mac=52:a4:00:12:78:66
\-chardev socket,id=mirror0,host=3.3.3.3,port=9003,server=on,wait=off
\-chardev socket,id=compare1,host=3.3.3.3,port=9004,server=on,wait=off
\-chardev socket,id=compare0,host=3.3.3.3,port=9001,server=on,wait=off
\-chardev socket,id=compare0\-0,host=3.3.3.3,port=9001
\-chardev socket,id=compare_out,host=3.3.3.3,port=9005,server=on,wait=off
\-chardev socket,id=compare_out0,host=3.3.3.3,port=9005
\-chardev socket,id=notify_way,host=3.3.3.3,port=9009,server=on,wait=off
\-object filter\-mirror,id=m0,netdev=hn0,queue=tx,outdev=mirror0
\-object filter\-redirector,netdev=hn0,id=redire0,queue=rx,indev=compare_out
\-object filter\-redirector,netdev=hn0,id=redire1,queue=rx,outdev=compare0
\-object iothread,id=iothread1
\-object colo\-compare,id=comp0,primary_in=compare0\-0,secondary_in=compare1,outdev=compare_out0,notify_dev=nofity_way,iothread=iothread1

secondary:
\-netdev tap,id=hn0,vhost=off,script=/etc/qemu\-ifup,down script=/etc/qemu\-ifdown
\-device e1000,netdev=hn0,mac=52:a4:00:12:78:66
\-chardev socket,id=red0,host=3.3.3.3,port=9003
\-chardev socket,id=red1,host=3.3.3.3,port=9004
\-object filter\-redirector,id=f1,netdev=hn0,queue=tx,indev=red0
\-object filter\-redirector,id=f2,netdev=hn0,queue=rx,outdev=red1
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
If you want to know the detail of above command line, you can
read the colo\-compare git log.
.TP
.B \fB\-object cryptodev\-backend\-builtin,id=id[,queues=queues]\fP
Creates a cryptodev backend which executes crypto operations from
the QEMU cipher APIs. The id parameter is a unique ID that will
be used to reference this cryptodev backend from the
\fBvirtio\-crypto\fP device. The queues parameter is optional,
which specify the queue number of cryptodev backend, the default
of queues is 1.
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \e
  [...] \e
      \-object cryptodev\-backend\-builtin,id=cryptodev0 \e
      \-device virtio\-crypto\-pci,id=crypto0,cryptodev=cryptodev0 \e
  [...]
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-object cryptodev\-vhost\-user,id=id,chardev=chardevid[,queues=queues]\fP
Creates a vhost\-user cryptodev backend, backed by a chardev
chardevid. The id parameter is a unique ID that will be used to
reference this cryptodev backend from the \fBvirtio\-crypto\fP
device. The chardev should be a unix domain socket backed one.
The vhost\-user uses a specifically defined protocol to pass
vhost ioctl replacement messages to an application on the other
end of the socket. The queues parameter is optional, which
specify the queue number of cryptodev backend for multiqueue
vhost\-user, the default of queues is 1.
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \e
  [...] \e
      \-chardev socket,id=chardev0,path=/path/to/socket \e
      \-object cryptodev\-vhost\-user,id=cryptodev0,chardev=chardev0 \e
      \-device virtio\-crypto\-pci,id=crypto0,cryptodev=cryptodev0 \e
  [...]
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-object secret,id=id,data=string,format=raw|base64[,keyid=secretid,iv=string]\fP

.TP
.B \fB\-object secret,id=id,file=filename,format=raw|base64[,keyid=secretid,iv=string]\fP
Defines a secret to store a password, encryption key, or some
other sensitive data. The sensitive data can either be passed
directly via the data parameter, or indirectly via the file
parameter. Using the data parameter is insecure unless the
sensitive data is encrypted.
.sp
The sensitive data can be provided in raw format (the default),
or base64. When encoded as JSON, the raw format only supports
valid UTF\-8 characters, so base64 is recommended for sending
binary data. QEMU will convert from which ever format is
provided to the format it needs internally. eg, an RBD password
can be provided in raw format, even though it will be base64
encoded when passed onto the RBD sever.
.sp
For added protection, it is possible to encrypt the data
associated with a secret using the AES\-256\-CBC cipher. Use of
encryption is indicated by providing the keyid and iv
parameters. The keyid parameter provides the ID of a previously
defined secret that contains the AES\-256 decryption key. This
key should be 32\-bytes long and be base64 encoded. The iv
parameter provides the random initialization vector used for
encryption of this particular secret and should be a base64
encrypted string of the 16\-byte IV.
.sp
The simplest (insecure) usage is to provide the secret inline
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \-object secret,id=sec0,data=letmein,format=raw
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
The simplest secure usage is to provide the secret via a file
.sp
# printf "letmein" > mypasswd.txt # QEMU_SYSTEM_MACRO \-object
secret,id=sec0,file=mypasswd.txt,format=raw
.sp
For greater security, AES\-256\-CBC should be used. To illustrate
usage, consider the openssl command line tool which can encrypt
the data. Note that when encrypting, the plaintext must be
padded to the cipher block size (32 bytes) using the standard
PKCS#5/6 compatible padding algorithm.
.sp
First a master key needs to be created in base64 encoding:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# openssl rand \-base64 32 > key.b64
# KEY=$(base64 \-d key.b64 | hexdump  \-v \-e \(aq/1 "%02X"\(aq)
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Each secret to be encrypted needs to have a random
initialization vector generated. These do not need to be kept
secret
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# openssl rand \-base64 16 > iv.b64
# IV=$(base64 \-d iv.b64 | hexdump  \-v \-e \(aq/1 "%02X"\(aq)
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
The secret to be defined can now be encrypted, in this case
we\(aqre telling openssl to base64 encode the result, but it could
be left as raw bytes if desired.
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# SECRET=$(printf "letmein" |
           openssl enc \-aes\-256\-cbc \-a \-K $KEY \-iv $IV)
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
When launching QEMU, create a master secret pointing to
\fBkey.b64\fP and specify that to be used to decrypt the user
password. Pass the contents of \fBiv.b64\fP to the second secret
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \e
    \-object secret,id=secmaster0,format=base64,file=key.b64 \e
    \-object secret,id=sec0,keyid=secmaster0,format=base64,\e
        data=$SECRET,iv=$(<iv.b64)
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-object sev\-guest,id=id,cbitpos=cbitpos,reduced\-phys\-bits=val,[sev\-device=string,policy=policy,handle=handle,dh\-cert\-file=file,session\-file=file,kernel\-hashes=on|off]\fP
Create a Secure Encrypted Virtualization (SEV) guest object,
which can be used to provide the guest memory encryption support
on AMD processors.
.sp
When memory encryption is enabled, one of the physical address
bit (aka the C\-bit) is utilized to mark if a memory page is
protected. The \fBcbitpos\fP is used to provide the C\-bit
position. The C\-bit position is Host family dependent hence user
must provide this value. On EPYC, the value should be 47.
.sp
When memory encryption is enabled, we loose certain bits in
physical address space. The \fBreduced\-phys\-bits\fP is used to
provide the number of bits we loose in physical address space.
Similar to C\-bit, the value is Host family dependent. On EPYC,
the value should be 5.
.sp
The \fBsev\-device\fP provides the device file to use for
communicating with the SEV firmware running inside AMD Secure
Processor. The default device is \(aq/dev/sev\(aq. If hardware
supports memory encryption then /dev/sev devices are created by
CCP driver.
.sp
The \fBpolicy\fP provides the guest policy to be enforced by the
SEV firmware and restrict what configuration and operational
commands can be performed on this guest by the hypervisor. The
policy should be provided by the guest owner and is bound to the
guest and cannot be changed throughout the lifetime of the
guest. The default is 0.
.sp
If guest \fBpolicy\fP allows sharing the key with another SEV
guest then \fBhandle\fP can be use to provide handle of the guest
from which to share the key.
.sp
The \fBdh\-cert\-file\fP and \fBsession\-file\fP provides the guest
owner\(aqs Public Diffie\-Hillman key defined in SEV spec. The PDH
and session parameters are used for establishing a cryptographic
session with the guest owner to negotiate keys used for
attestation. The file must be encoded in base64.
.sp
The \fBkernel\-hashes\fP adds the hashes of given kernel/initrd/
cmdline to a designated guest firmware page for measured Linux
boot with \-kernel. The default is off. (Since 6.2)
.sp
e.g to launch a SEV guest
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \e
    ...... \e
    \-object sev\-guest,id=sev0,cbitpos=47,reduced\-phys\-bits=5 \e
    \-machine ...,memory\-encryption=sev0 \e
    .....
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-object authz\-simple,id=id,identity=string\fP
Create an authorization object that will control access to
network services.
.sp
The \fBidentity\fP parameter is identifies the user and its format
depends on the network service that authorization object is
associated with. For authorizing based on TLS x509 certificates,
the identity must be the x509 distinguished name. Note that care
must be taken to escape any commas in the distinguished name.
.sp
An example authorization object to validate a x509 distinguished
name would look like:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \e
    ... \e
    \-object \(aqauthz\-simple,id=auth0,identity=CN=laptop.example.com,,O=Example Org,,L=London,,ST=London,,C=GB\(aq \e
    ...
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Note the use of quotes due to the x509 distinguished name
containing whitespace, and escaping of \(aq,\(aq.
.TP
.B \fB\-object authz\-listfile,id=id,filename=path,refresh=on|off\fP
Create an authorization object that will control access to
network services.
.sp
The \fBfilename\fP parameter is the fully qualified path to a file
containing the access control list rules in JSON format.
.sp
An example set of rules that match against SASL usernames might
look like:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
{
  "rules": [
     { "match": "fred", "policy": "allow", "format": "exact" },
     { "match": "bob", "policy": "allow", "format": "exact" },
     { "match": "danb", "policy": "deny", "format": "glob" },
     { "match": "dan*", "policy": "allow", "format": "exact" },
  ],
  "policy": "deny"
}
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
When checking access the object will iterate over all the rules
and the first rule to match will have its \fBpolicy\fP value
returned as the result. If no rules match, then the default
\fBpolicy\fP value is returned.
.sp
The rules can either be an exact string match, or they can use
the simple UNIX glob pattern matching to allow wildcards to be
used.
.sp
If \fBrefresh\fP is set to true the file will be monitored and
automatically reloaded whenever its content changes.
.sp
As with the \fBauthz\-simple\fP object, the format of the identity
strings being matched depends on the network service, but is
usually a TLS x509 distinguished name, or a SASL username.
.sp
An example authorization object to validate a SASL username
would look like:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \e
    ... \e
    \-object authz\-simple,id=auth0,filename=/etc/qemu/vnc\-sasl.acl,refresh=on \e
    ...
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-object authz\-pam,id=id,service=string\fP
Create an authorization object that will control access to
network services.
.sp
The \fBservice\fP parameter provides the name of a PAM service to
use for authorization. It requires that a file
\fB/etc/pam.d/service\fP exist to provide the configuration for
the \fBaccount\fP subsystem.
.sp
An example authorization object to validate a TLS x509
distinguished name would look like:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
# qemu\-system\-x86_64 \e
    ... \e
    \-object authz\-pam,id=auth0,service=qemu\-vnc \e
    ...
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
There would then be a corresponding config file for PAM at
\fB/etc/pam.d/qemu\-vnc\fP that contains:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
account requisite  pam_listfile.so item=user sense=allow \e
           file=/etc/qemu/vnc.allow
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Finally the \fB/etc/qemu/vnc.allow\fP file would contain the list
of x509 distinguished names that are permitted access
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
CN=laptop.example.com,O=Example Home,L=London,ST=London,C=GB
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fB\-object iothread,id=id,poll\-max\-ns=poll\-max\-ns,poll\-grow=poll\-grow,poll\-shrink=poll\-shrink,aio\-max\-batch=aio\-max\-batch\fP
Creates a dedicated event loop thread that devices can be
assigned to. This is known as an IOThread. By default device
emulation happens in vCPU threads or the main event loop thread.
This can become a scalability bottleneck. IOThreads allow device
emulation and I/O to run on other host CPUs.
.sp
The \fBid\fP parameter is a unique ID that will be used to
reference this IOThread from \fB\-device ...,iothread=id\fP\&.
Multiple devices can be assigned to an IOThread. Note that not
all devices support an \fBiothread\fP parameter.
.sp
The \fBquery\-iothreads\fP QMP command lists IOThreads and reports
their thread IDs so that the user can configure host CPU
pinning/affinity.
.sp
IOThreads use an adaptive polling algorithm to reduce event loop
latency. Instead of entering a blocking system call to monitor
file descriptors and then pay the cost of being woken up when an
event occurs, the polling algorithm spins waiting for events for
a short time. The algorithm\(aqs default parameters are suitable
for many cases but can be adjusted based on knowledge of the
workload and/or host device latency.
.sp
The \fBpoll\-max\-ns\fP parameter is the maximum number of
nanoseconds to busy wait for events. Polling can be disabled by
setting this value to 0.
.sp
The \fBpoll\-grow\fP parameter is the multiplier used to increase
the polling time when the algorithm detects it is missing events
due to not polling long enough.
.sp
The \fBpoll\-shrink\fP parameter is the divisor used to decrease
the polling time when the algorithm detects it is spending too
long polling without encountering events.
.sp
The \fBaio\-max\-batch\fP parameter is the maximum number of requests
in a batch for the AIO engine, 0 means that the engine will use
its default.
.sp
The IOThread parameters can be modified at run\-time using the
\fBqom\-set\fP command (where \fBiothread1\fP is the IOThread\(aqs
\fBid\fP):
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
(qemu) qom\-set /objects/iothread1 poll\-max\-ns 100000
.ft P
.fi
.UNINDENT
.UNINDENT
.UNINDENT
.UNINDENT
.sp
During the graphical emulation, you can use special key combinations to
change modes. The default key mappings are shown below, but if you use
\fB\-alt\-grab\fP then the modifier is Ctrl\-Alt\-Shift (instead of Ctrl\-Alt)
and if you use \fB\-ctrl\-grab\fP then the modifier is the right Ctrl key
(instead of Ctrl\-Alt):
.INDENT 0.0
.TP
.B Ctrl\-Alt\-f
Toggle full screen
.TP
.B Ctrl\-Alt\-+
Enlarge the screen
.TP
.B Ctrl\-Alt\-\-
Shrink the screen
.TP
.B Ctrl\-Alt\-u
Restore the screen\(aqs un\-scaled dimensions
.TP
.B Ctrl\-Alt\-n
Switch to virtual console \(aqn\(aq. Standard console mappings are:
.INDENT 7.0
.TP
.B \fI1\fP
Target system display
.TP
.B \fI2\fP
Monitor
.TP
.B \fI3\fP
Serial port
.UNINDENT
.TP
.B Ctrl\-Alt
Toggle mouse and keyboard grab.
.UNINDENT
.sp
In the virtual consoles, you can use Ctrl\-Up, Ctrl\-Down, Ctrl\-PageUp and
Ctrl\-PageDown to move in the back log.
.sp
During emulation, if you are using a character backend multiplexer
(which is the default if you are using \fB\-nographic\fP) then several
commands are available via an escape sequence. These key sequences all
start with an escape character, which is Ctrl\-a by default, but can be
changed with \fB\-echr\fP\&. The list below assumes you\(aqre using the default.
.INDENT 0.0
.TP
.B Ctrl\-a h
Print this help
.TP
.B Ctrl\-a x
Exit emulator
.TP
.B Ctrl\-a s
Save disk data back to file (if \-snapshot)
.TP
.B Ctrl\-a t
Toggle console timestamps
.TP
.B Ctrl\-a b
Send break (magic sysrq in Linux)
.TP
.B Ctrl\-a c
Rotate between the frontends connected to the multiplexer (usually
this switches between the monitor and the console)
.TP
.B Ctrl\-a Ctrl\-a
Send the escape character to the frontend
.UNINDENT
.SH NOTES
.sp
In addition to using normal file images for the emulated storage
devices, QEMU can also use networked resources such as iSCSI devices.
These are specified using a special URL syntax.
.INDENT 0.0
.TP
.B \fBiSCSI\fP
iSCSI support allows QEMU to access iSCSI resources directly and use
as images for the guest storage. Both disk and cdrom images are
supported.
.sp
Syntax for specifying iSCSI LUNs is
"iscsi://<target\-ip>[:<port>]/<target\-iqn>/<lun>"
.sp
By default qemu will use the iSCSI initiator\-name
\(aqiqn.2008\-11.org.linux\-kvm[:<name>]\(aq but this can also be set from
the command line or a configuration file.
.sp
Since version QEMU 2.4 it is possible to specify a iSCSI request
timeout to detect stalled requests and force a reestablishment of the
session. The timeout is specified in seconds. The default is 0 which
means no timeout. Libiscsi 1.15.0 or greater is required for this
feature.
.sp
Example (without authentication):
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-iscsi initiator\-name=iqn.2001\-04.com.example:my\-initiator \e
                 \-cdrom iscsi://192.0.2.1/iqn.2001\-04.com.example/2 \e
                 \-drive file=iscsi://192.0.2.1/iqn.2001\-04.com.example/1
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example (CHAP username/password via URL):
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-drive file=iscsi:\fI\%//user%password@192.0.2.1/iqn.2001\-04.com.example/1\fP
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example (CHAP username/password via environment variables):
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
LIBISCSI_CHAP_USERNAME="user" \e
LIBISCSI_CHAP_PASSWORD="password" \e
qemu\-system\-x86_64 \-drive file=iscsi://192.0.2.1/iqn.2001\-04.com.example/1
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBNBD\fP
QEMU supports NBD (Network Block Devices) both using TCP protocol as
well as Unix Domain Sockets. With TCP, the default port is 10809.
.sp
Syntax for specifying a NBD device using TCP, in preferred URI form:
"nbd://<server\-ip>[:<port>]/[<export>]"
.sp
Syntax for specifying a NBD device using Unix Domain Sockets;
remember that \(aq?\(aq is a shell glob character and may need quoting:
"nbd+unix:///[<export>]?socket=<domain\-socket>"
.sp
Older syntax that is also recognized:
"nbd:<server\-ip>:<port>[:exportname=<export>]"
.sp
Syntax for specifying a NBD device using Unix Domain Sockets
"nbd:unix:<domain\-socket>[:exportname=<export>]"
.sp
Example for TCP
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-\-drive file=nbd:192.0.2.1:30000
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example for Unix Domain Sockets
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-\-drive file=nbd:unix:/tmp/nbd\-socket
.ft P
.fi
.UNINDENT
.UNINDENT
.TP
.B \fBSSH\fP
QEMU supports SSH (Secure Shell) access to remote disks.
.sp
Examples:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-drive file=ssh:\fI\%//user@host/path/to/disk.img\fP
qemu\-system\-x86_64 \-drive file.driver=ssh,file.user=user,file.host=host,file.port=22,file.path=/path/to/disk.img
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Currently authentication must be done using ssh\-agent. Other
authentication methods may be supported in future.
.TP
.B \fBGlusterFS\fP
GlusterFS is a user space distributed file system. QEMU supports the
use of GlusterFS volumes for hosting VM disk images using TCP, Unix
Domain Sockets and RDMA transport protocols.
.sp
Syntax for specifying a VM disk image on GlusterFS volume is
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
URI:
gluster[+type]://[host[:port]]/volume/path[?socket=...][,debug=N][,logfile=...]

JSON:
\(aqjson:{"driver":"qcow2","file":{"driver":"gluster","volume":"testvol","path":"a.img","debug":N,"logfile":"...",
\                                 "server":[{"type":"tcp","host":"...","port":"..."},
\                                           {"type":"unix","socket":"..."}]}}\(aq
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
URI:
qemu\-system\-x86_64 \-\-drive file=gluster://192.0.2.1/testvol/a.img,
\                               file.debug=9,file.logfile=/var/log/qemu\-gluster.log

JSON:
qemu\-system\-x86_64 \(aqjson:{"driver":"qcow2",
\                          "file":{"driver":"gluster",
\                                   "volume":"testvol","path":"a.img",
\                                   "debug":9,"logfile":"/var/log/qemu\-gluster.log",
\                                   "server":[{"type":"tcp","host":"1.2.3.4","port":24007},
\                                             {"type":"unix","socket":"/var/run/glusterd.socket"}]}}\(aq
qemu\-system\-x86_64 \-drive driver=qcow2,file.driver=gluster,file.volume=testvol,file.path=/path/a.img,
\                                      file.debug=9,file.logfile=/var/log/qemu\-gluster.log,
\                                      file.server.0.type=tcp,file.server.0.host=1.2.3.4,file.server.0.port=24007,
\                                      file.server.1.type=unix,file.server.1.socket=/var/run/glusterd.socket
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
See also \fI\%http://www.gluster.org\fP\&.
.TP
.B \fBHTTP/HTTPS/FTP/FTPS\fP
QEMU supports read\-only access to files accessed over http(s) and
ftp(s).
.sp
Syntax using a single filename:
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
<protocol>://[<username>[:<password>]@]<host>/<path>
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
where:
.INDENT 7.0
.TP
.B \fBprotocol\fP
\(aqhttp\(aq, \(aqhttps\(aq, \(aqftp\(aq, or \(aqftps\(aq.
.TP
.B \fBusername\fP
Optional username for authentication to the remote server.
.TP
.B \fBpassword\fP
Optional password for authentication to the remote server.
.TP
.B \fBhost\fP
Address of the remote server.
.TP
.B \fBpath\fP
Path on the remote server, including any query string.
.UNINDENT
.sp
The following options are also supported:
.INDENT 7.0
.TP
.B \fBurl\fP
The full URL when passing options to the driver explicitly.
.TP
.B \fBreadahead\fP
The amount of data to read ahead with each range request to the
remote server. This value may optionally have the suffix \(aqT\(aq, \(aqG\(aq,
\(aqM\(aq, \(aqK\(aq, \(aqk\(aq or \(aqb\(aq. If it does not have a suffix, it will be
assumed to be in bytes. The value must be a multiple of 512 bytes.
It defaults to 256k.
.TP
.B \fBsslverify\fP
Whether to verify the remote server\(aqs certificate when connecting
over SSL. It can have the value \(aqon\(aq or \(aqoff\(aq. It defaults to
\(aqon\(aq.
.TP
.B \fBcookie\fP
Send this cookie (it can also be a list of cookies separated by
\(aq;\(aq) with each outgoing request. Only supported when using
protocols such as HTTP which support cookies, otherwise ignored.
.TP
.B \fBtimeout\fP
Set the timeout in seconds of the CURL connection. This timeout is
the time that CURL waits for a response from the remote server to
get the size of the image to be downloaded. If not set, the
default timeout of 5 seconds is used.
.UNINDENT
.sp
Note that when passing options to qemu explicitly, \fBdriver\fP is the
value of <protocol>.
.sp
Example: boot from a remote Fedora 20 live ISO image
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-system\-x86_64 \-\-drive media=cdrom,file=https://archives.fedoraproject.org/pub/archive/fedora/linux/releases/20/Live/x86_64/Fedora\-Live\-Desktop\-x86_64\-20\-1.iso,readonly

qemu\-system\-x86_64 \-\-drive media=cdrom,file.driver=http,file.url=http://archives.fedoraproject.org/pub/fedora/linux/releases/20/Live/x86_64/Fedora\-Live\-Desktop\-x86_64\-20\-1.iso,readonly
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example: boot from a remote Fedora 20 cloud image using a local
overlay for writes, copy\-on\-read, and a readahead of 64k
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-img create \-f qcow2 \-o backing_file=\(aqjson:{"file.driver":"http",, "file.url":"\fI\%http://archives.fedoraproject.org/pub/archive/fedora/linux/releases/20/Images/x86_64/Fedora\-x86_64\-20\-20131211.1\-sda.qcow2\fP",, "file.readahead":"64k"}\(aq /tmp/Fedora\-x86_64\-20\-20131211.1\-sda.qcow2

qemu\-system\-x86_64 \-drive file=/tmp/Fedora\-x86_64\-20\-20131211.1\-sda.qcow2,copy\-on\-read=on
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Example: boot from an image stored on a VMware vSphere server with a
self\-signed certificate using a local overlay for writes, a readahead
of 64k and a timeout of 10 seconds.
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
qemu\-img create \-f qcow2 \-o backing_file=\(aqjson:{"file.driver":"https",, "file.url":"\fI\%https://user:password@vsphere.example.com/folder/test/test\-flat.vmdk?dcPath=Datacenter&dsName=datastore1\fP",, "file.sslverify":"off",, "file.readahead":"64k",, "file.timeout":10}\(aq /tmp/test.qcow2

qemu\-system\-x86_64 \-drive file=/tmp/test.qcow2
.ft P
.fi
.UNINDENT
.UNINDENT
.UNINDENT
.SH SEE ALSO
.sp
The HTML documentation of QEMU for more precise information and Linux
user mode emulator invocation.
.SH AUTHOR
Fabrice Bellard
.SH COPYRIGHT
2022, The QEMU Project Developers
.\" Generated by docutils manpage writer.
.
